import{r as d,j as e}from"./client-ZKQMN23D.js";import{d as ae}from"./Sorter-D-iJhMGf.js";import{l as k}from"./index.m-DI45-rQC.js";import{f as P}from"./Content-CSTk_AN3.js";import{g as ie}from"./Autocomplete.renderers-r1kulAc7.js";import{A as le}from"./AutocompleteSingle-CdSmmfNH.js";import{u as F}from"./useDataSource-BcXzKQdo.js";import{G as y}from"./Grid-DLryTqtI.js";import{A as W}from"./Autocomplete-DXgXs46U.js";import{T as R,F as ce}from"./TextField-sycmgB1j.js";import{B as v}from"./Button-8kMDeHcM.js";import{T as de,a as D,b as ue}from"./TableRow-B3upNWdu.js";import{T as me}from"./TableHead-CbBxbIBo.js";import{T as b}from"./TableCell-ChGbszKc.js";import{T as G}from"./Tooltip-BU7xgxFh.js";import{I as pe}from"./List-g_COJ0Le.js";import{D as he,a as fe,b as xe,c as ge}from"./DialogTitle-BNfmKa8y.js";import{F as H}from"./FormLabel-BwLMeq7e.js";import{I as K,S as je}from"./Select-BviP6ddm.js";import{M as ye}from"./MenuItem-BQV6VCqx.js";import{r as L,s as be,t as ve,v as Te,x as Pe,y as V,z as _e,A as Se,c as q,B as A,k as ke,h as Ce,f as Ie,e as Me,M as Ae,C as Fe,D as Le,F as Oe,G as we,H as Re,I as Be,J as Ee,K as $e}from"./Config-CbgY5lav.js";import{B as J}from"./Box-CGz8vZlR.js";import{T as We}from"./Typography-DYGSvwsR.js";import{u as De}from"./Grow-sQgJtlQN.js";const xt=({initialPartners:r=[],role:s,onChange:o,adminMode:a=!1})=>{const[i,u]=d.useState(r),[l,p]=d.useState(null),[c,f]=d.useState(""),[m,x]=d.useState(""),[_,g]=d.useState(""),[C,X]=d.useState([]),[Y,B]=d.useState([]),[T,O]=d.useState(null),w=F({mode:"xhr",search:c,xhrUrl:k("api.affiliates.search"),dataNotWrapped:!0,pageSize:42}),E=d.useRef(null),{paginatedData:I}=F({mode:"xhr",search:m,xhrUrl:k("api.dcpartners.search"),dataNotWrapped:!0,pageSize:42});d.useEffect(()=>{var t,n;if(!((n=(t=w.paginatedData)==null?void 0:t.data)!=null&&n.length)){B([]);return}B([...w.paginatedData.data])},[w.paginatedData]),d.useEffect(()=>{X((I==null?void 0:I.data)||[])},[I]);const Z=()=>{var h,j,S;if(!l)return;const t=(h=l.collections)==null?void 0:h.find(({type:M})=>M==="country"),n=[...i,{role:s,affiliate_item_id:l.id,name:`${P(l)||((j=l.affiliate)==null?void 0:j.official_name)||""}`,acronym:(S=l.affiliate)==null?void 0:S.acronym,country_collection_id:t==null?void 0:t.id,country_name:t?P(t):void 0}];u(n),o(n),f(""),p(null)},ee=()=>{var n;if(!m)return;const t=[...i,{role:s,name:m,acronym:_||void 0,country_collection_id:T==null?void 0:T.id,country_name:T?P(T):void 0}];u(t),o(t),x(""),g(""),O(null),(n=E.current)==null||n.reset()},te=t=>{const n=[...i];n.splice(t,1),u(n),o(n)},ne=(t,n)=>{switch(n){case"createOption":f(t);break;case"selectOption":p(t);break;case"clear":p(null),f("");break}},re=d.useCallback(t=>{const n=[...i,...t.map(h=>{var S,M,$;const j=(S=h.collections)==null?void 0:S.find(({type:se})=>se==="country");return{role:s,affiliate_item_id:h.id,name:`${P(h)||((M=h.affiliate)==null?void 0:M.official_name)||""}`,acronym:($=h.affiliate)==null?void 0:$.acronym,country_collection_id:j==null?void 0:j.id,country_name:j?P(j):void 0}})];u(n),o(n)},[i,o,s]),oe=()=>{u([]),o([])};return e.jsxs(e.Fragment,{children:[e.jsxs(y,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(y,{item:!0,xs:10,children:e.jsx(W,{includeInputInList:!0,value:l,options:Y,filterOptions:t=>t,onChange:(t,n,h)=>ne(n,h),inputValue:c,onInputChange:(t,n)=>{f(n)},noOptionsText:"Start typing to search...",getOptionLabel:N,renderOption:(t,n)=>d.createElement("li",{...t,key:n.id},N(n)),renderInput:t=>e.jsx(R,{...t,label:"Member Partner",placeholder:"Type to search",fullWidth:!0,InputLabelProps:{shrink:!0}}),isOptionEqualToValue:({id:t},{id:n})=>t===n})}),e.jsx(y,{item:!0,xs:!0,children:e.jsx(v,{variant:"contained",disabled:!l,onClick:()=>Z(),children:"Add"})}),s==="benefitting"&&e.jsx(y,{item:!0,xs:12,my:-2,display:"flex",children:e.jsx(Ne,{onAdd:re})}),e.jsx(y,{item:!0,xs:a?4:5,children:e.jsx(W,{includeInputInList:!0,inputValue:m,options:C,filterOptions:t=>t,freeSolo:!0,onChange:(t,n)=>{typeof n=="string"||(n&&(x(n.name),g(n.acronym||"")),O((n==null?void 0:n.country)||null))},onInputChange:(t,n)=>{x(n)},noOptionsText:"Start typing to search...",getOptionLabel:t=>typeof t=="string"?t:t.name,renderOption:(t,n)=>d.createElement("li",{...t,key:n.name},n.name,n.acronym?` (${n.acronym})`:""),renderInput:t=>e.jsx(R,{...t,label:"Non-member Partner",placeholder:"Type to search",fullWidth:!0,InputLabelProps:{shrink:!0}}),isOptionEqualToValue:({name:t},{name:n})=>t===n})}),a&&e.jsx(y,{item:!0,xs:2,children:e.jsx(R,{value:_,onChange:t=>g(t.target.value),fullWidth:!0,label:"Acronym"})}),e.jsx(y,{item:!0,xs:a?4:5,children:e.jsx(le,{label:"Partner country",value:T,onChange:t=>O(t),dataSource:{xhrUrl:k("api.countries.search"),dataNotWrapped:!0},getOptionLabel:ie,autocompleteProps:{fullWidth:!0},controlRef:E})}),e.jsx(y,{item:!0,xs:!0,children:e.jsx(v,{variant:"contained",disabled:!m,onClick:()=>ee(),children:"Add"})})]}),i.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(de,{sx:{width:1},size:"small",children:[e.jsx(me,{children:e.jsxs(D,{children:[e.jsx(b,{children:"Partner"}),e.jsx(b,{sx:{whiteSpace:"nowrap"},children:"Country"}),e.jsx(b,{children:e.jsx(G,{title:"Linked in member database?",children:e.jsx("span",{children:"Member"})})}),e.jsx(b,{})]})}),e.jsx(ue,{children:i.map((t,n)=>e.jsxs(D,{children:[e.jsxs(b,{children:[t.name," ",t.acronym?`(${t.acronym})`:""]}),e.jsx(b,{children:t.country_name??(t.country?P(t.country):"")}),e.jsx(b,{children:t.affiliate_item_id?"yes":"no"}),e.jsx(b,{padding:"none",children:e.jsx(pe,{onClick:()=>te(n),edge:"end",size:"small",children:e.jsx(ae,{})})})]},n))})]}),e.jsx(v,{variant:"text",onClick:oe,sx:{textTransform:"none"},children:"Remove all partners"})]})]})},N=r=>{var o,a,i,u,l,p;const s=(o=r.collections)==null?void 0:o.find(({type:c})=>c==="country");return`${((a=r.affiliate)==null?void 0:a.official_name)||((i=r.content)==null?void 0:i.title)||`${r.id}`}${(u=r.affiliate)!=null&&u.acronym?` (${(l=r.affiliate)==null?void 0:l.acronym})`:""}${(p=s==null?void 0:s.content)!=null&&p.title?` [${s.content.title}]`:""}`},Ne=({onAdd:r})=>{var f;const[s,o]=d.useState(!1),{paginatedData:a}=F({mode:"xhr",search:s?" ":void 0,xhrUrl:k("api.regions.search"),dataNotWrapped:!0,pageSize:42}),[i,u]=d.useState([]),[l,p]=d.useState();d.useEffect(()=>{u((a==null?void 0:a.data)||[])},[a]);const{paginatedData:c}=F({mode:"xhr",filter:l?{filter:{region_id:l}}:void 0,xhrUrl:k("api.affiliates.search"),dataNotWrapped:!0,pageSize:1e3});return e.jsxs(e.Fragment,{children:[e.jsx(v,{variant:"text",onClick:()=>o(!0),sx:{textTransform:"none"},children:"Add all members from region"}),s&&e.jsxs(he,{maxWidth:"xs",fullWidth:!0,open:!0,onClose:()=>o(!1),children:[e.jsx(fe,{children:"Select region"}),e.jsx(xe,{children:e.jsxs(H,{fullWidth:!0,children:[e.jsx(K,{shrink:!0,children:"Region"}),e.jsx(je,{value:l!==void 0?`${l}`:"",onChange:m=>p(parseInt(m.target.value)||void 0),fullWidth:!0,label:"Region",children:i.map(m=>{var x;return e.jsx(ye,{value:m.id,children:(x=m.content)==null?void 0:x.title},m.id)})})]})}),e.jsxs(ge,{children:[e.jsx(v,{variant:"text",onClick:()=>o(!1),children:"Cancel"}),e.jsx(v,{disabled:!((f=c==null?void 0:c.data)!=null&&f.length),onClick:()=>{r((c==null?void 0:c.data)||[]),o(!1)},variant:"contained",children:`Add ${(c==null?void 0:c.data.length)||0} members`})]})]})]})},Q=r=>{const{active:s,tooltip:o,icon:a,onMouseDown:i}=r,u=!0,l=e.jsx(v,{size:"small",variant:s&&u?"contained":"text",onMouseDown:i,disabled:!u,endIcon:a,sx:{minWidth:0,p:.25,"& .MuiButton-endIcon":{mx:0}}});return o?e.jsx(G,{title:o,children:e.jsx("span",{children:l})}):l},ze=({type:r,inactiveType:s,active:o,...a})=>{const i=L();return i?e.jsx(Q,{active:o??(!!(i!=null&&i.selection)&&be(i,{match:{type:r}})),onMouseDown:i?()=>ve(i,{activeType:r,inactiveType:s}):void 0,...a}):null},z=({type:r=V,...s})=>{const o=L(),a=!!(o!=null&&o.selection)&&Te(o);return e.jsx(ze,{active:!!a&&a.list[0].type===r,type:r,onMouseDown:o?()=>Pe(o,{type:r}):void 0,...s})},U=({type:r,clear:s,...o})=>{const a=L();return e.jsx(Q,{active:!!(a!=null&&a.selection)&&_e(a,r),onMouseDown:a?()=>Se(a,{key:r,clear:s}):void 0,...o})},Ue=()=>{const r=L(),s=q.string(r,[]);return e.jsxs(J,{display:"flex",gap:.5,width:1,children:[e.jsx(U,{type:A(r,Ae),icon:e.jsx(ke,{})}),e.jsx(U,{type:A(r,Fe),icon:e.jsx(Ce,{})}),e.jsx(z,{type:A(r,V),icon:e.jsx(Ie,{})}),e.jsx(z,{type:A(r,Le),icon:e.jsx(Me,{})}),e.jsx(We,{variant:"caption",marginLeft:"auto",children:s.length||""})]})},Ge=(r,{options:{textLimit:s}})=>{const{normalizeNode:o}=r;return r.normalizeNode=a=>{if(s){const i=q.string(r,[]).length;if(i>s){we(r,{unit:i-s>100||i-s>10?"word":"character"});return}}return o(a)},r},He=Oe({key:"textLimit",withOverrides:Ge}),gt=({id:r,label:s,helperText:o,error:a,textLimit:i,initialValueAsText:u,FormControlProps:l,...p})=>{const c=De(),f=d.useMemo(()=>[...Re,He({options:{textLimit:i}})],[i]),m=d.useMemo(()=>{if(!u)return[{children:[{text:""}]}];try{const C=JSON.parse(u);if(Array.isArray(C))return C}catch{}return[{children:[{text:""}]}]},[u]),x=Be.focus(),_=r||`plate-editor-${s}`,g=x===_;return e.jsxs(H,{variant:"filled",fullWidth:!0,error:a,focused:g,...l,children:[e.jsx(K,{shrink:!0,children:s}),e.jsxs(Ee,{id:_,plugins:f,...p,initialValue:m,children:[e.jsx(J,{mt:3,px:1.5,children:e.jsx(Ue,{})}),e.jsx($e,{spellCheck:!1,autoFocus:!0,style:{paddingLeft:c.spacing(1.5),paddingRight:c.spacing(1.5),width:"100%",backgroundColor:"rgba(0, 0, 0, 0.06)",borderBottom:"1px solid rgba(0, 0, 0, 0.42)",borderBottomWidth:g?"2px":"1px",marginBottom:g?"-1px":0,borderBottomColor:g?c.palette.primary.main:"rgba(0, 0, 0, 0.42)",borderTopLeftRadius:c.shape.borderRadius,borderTopRightRadius:c.shape.borderRadius}})]}),e.jsx(ce,{children:o})]})};export{xt as M,gt as P};
