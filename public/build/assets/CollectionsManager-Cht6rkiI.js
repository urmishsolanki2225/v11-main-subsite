import{j as e,r as u}from"./client-ZKQMN23D.js";import{u as N}from"./index-BmtA0KFl.js";import{d as X}from"./RemoveCircle-CnluI2R2.js";import{l as Z}from"./index.m-DI45-rQC.js";import{f as _}from"./Content-CSTk_AN3.js";import{m as ee}from"./DataGridUtils-DqQ54bwL.js";import{P as I}from"./PublishStatusIcon-DtyKOrUb.js";import{a as te,L as re}from"./Listing-DOaYGk-1.js";import{D as se}from"./DataCellCollectionTree-AKS66MIS.js";import{L as ie,u as oe}from"./useDataSource-CV-XnRBP.js";import{f as ae,n as j}from"./MetaInfoManager-CqDpbzWQ.js";import{B as S}from"./Box-BUYeTdQC.js";import{g as ne,h as A,i as le,j as ce,k as de,S as ue,a as me,A as pe,D as fe}from"./app-Ck7UBcd6.js";import{i as k}from"./identifier-CVVhstXo.js";import{T as y,r as C}from"./Typography-BWGjmqeb.js";import"./dayjs.min-BIwLhz4I.js";import"./Section-DFrm5BHt.js";import{S as xe}from"./Sorter-RHivQPlc.js";import"./Config--wjR88LA.js";import"./InputFile-D0HUmVGA.js";import{G as b}from"./Grid-CEw1b08m.js";import{I as ve}from"./List-Dh7P2IJ_.js";const F=t=>{var n;const s=_(t);if(t.type==="dossier_sub"){const o=(n=t.parent_collections)==null?void 0:n.find(({type:r})=>r==="dossier");if(o)return`${_(o)} – ${s}`}return s},O=({item:t,dragHandle:s,removeHandle:n,children:o})=>e.jsxs(S,{sx:{display:"flex",whiteSpace:"pre",alignItems:"baseline",borderRadius:1,borderStyle:"solid",borderWidth:1,borderColor:"divider",paddingLeft:s?0:1,paddingRight:1,margin:.5},children:[s,e.jsx(y,{variant:"body1",component:"span",sx:{flexGrow:2},children:o||F(t)||"-untitled-"}),e.jsx(I,{item:t}),e.jsx(y,{variant:"caption",component:"span",sx:{flexBasis:"10%",flexShrink:0,marginLeft:.5},children:t.type}),n]}),he=t=>{const s=t.item;return e.jsx(O,{...t,children:e.jsx(ie,{toRoute:"admin.collections.edit",query:{id:s.id},children:F(s)||"-untitled-"})})},L=({options:t,label:s,onPick:n,skipMenu:o})=>{const[r,v]=u.useState(),[f,g]=u.useState(),[x,h]=u.useState(),[i,m]=u.useState(s),[l]=u.useState("title"),[p,c]=u.useState(!1),M=oe({mode:"xhr",search:f,filter:x,sort:l,xhrUrl:x?Z("admin.collections.index"):void 0}),T=a=>{c(!1),n(a)},J=[{field:"id",renderCell:a=>e.jsxs(S,{display:"flex",justifyContent:"space-between",children:[a.id," ",e.jsx(se,{collection:a.row,onSelect:T})]}),align:"right"},{field:"title",renderCell:a=>{var d;return e.jsxs("span",{children:[((d=M.childTypes)==null?void 0:d.includes(a.row.type))&&e.jsx(e.Fragment,{children:"—  "}),e.jsx(I,{item:a.row})," ",_(a.row)??"- no title -"]})},flex:4},ee("created_at")];u.useEffect(()=>{if(r!=null&&r.length){c(!0);const a=r.map(d=>d.join(",")).join(",");h({filter:{type:a,status:"published"}})}else h(void 0),c(!1)},[r]);const K=[{label:"Hide unpublished",name:"status",value:"published"}];return e.jsx(ae,{label:s,options:t,filter:x,filterOptions:K,onChangeFilter:h,onSearch:g,onSelect:(a,d)=>{v([...a]),m(d!=null&&d.length?d[0].label:s)},onClose:()=>c(!1),skipMenu:o,dialog:{title:i??s,wide:!0,tall:!0},open:p,children:e.jsx(te,{onSelect:a=>T(a),onCancel:()=>c(!1),children:e.jsx(re,{columns:J,dataSource:M,selectMode:"single"})})})};var P={},je=k;Object.defineProperty(P,"__esModule",{value:!0});var R=P.default=void 0,be=je(C()),ye=e;R=P.default=(0,be.default)((0,ye.jsx)("path",{d:"m19 18 2 1V3c0-1.1-.9-2-2-2H8.99C7.89 1 7 1.9 7 3h10c1.1 0 2 .9 2 2zM15 5H5c-1.1 0-2 .9-2 2v16l7-3 7 3V7c0-1.1-.9-2-2-2"}),"Bookmarks");var $={},ge=k;Object.defineProperty($,"__esModule",{value:!0});var V=$.default=void 0,_e=ge(C()),B=e;V=$.default=(0,_e.default)([(0,B.jsx)("path",{d:"M21 5c-1.11-.35-2.33-.5-3.5-.5-1.95 0-4.05.4-5.5 1.5-1.45-1.1-3.55-1.5-5.5-1.5S2.45 4.9 1 6v14.65c0 .25.25.5.5.5.1 0 .15-.05.25-.05C3.1 20.45 5.05 20 6.5 20c1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.3 4.75 1.05.1.05.15.05.25.05.25 0 .5-.25.5-.5V6c-.6-.45-1.25-.75-2-1m0 13.5c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V8c1.35-.85 3.8-1.5 5.5-1.5 1.2 0 2.4.15 3.5.5z"},"0"),(0,B.jsx)("path",{d:"M17.5 10.5c.88 0 1.73.09 2.5.26V9.24c-.79-.15-1.64-.24-2.5-.24-1.7 0-3.24.29-4.5.83v1.66c1.13-.64 2.7-.99 4.5-.99M13 12.49v1.66c1.13-.64 2.7-.99 4.5-.99.88 0 1.73.09 2.5.26V11.9c-.79-.15-1.64-.24-2.5-.24-1.7 0-3.24.3-4.5.83m4.5 1.84c-1.7 0-3.24.29-4.5.83v1.66c1.13-.64 2.7-.99 4.5-.99.88 0 1.73.09 2.5.26v-1.52c-.79-.16-1.64-.24-2.5-.24"},"1")],"MenuBook");var w={},Se=k;Object.defineProperty(w,"__esModule",{value:!0});var D=w.default=void 0,ke=Se(C()),Ce=e;D=w.default=(0,ke.default)((0,Ce.jsx)("path",{d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m-9-2V7H4v3H1v2h3v3h2v-3h3v-2zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"PersonAdd");const q=[{value:["author"],label:"Author",icon:e.jsx(D,{})}],z=[{value:["articles"],label:"Articles",icon:e.jsx(ne,{})}],H=[{value:["contacts"],label:"Contacts",icon:e.jsx(D,{})}],E=[{value:["country"],label:"Country",icon:e.jsx(A,{})},{value:["region"],label:"Region",icon:e.jsx(A,{})}],G=[{value:["dossier","dossier_sub"],label:"Dossier",icon:e.jsx(le,{})}],W=[{value:["library"],label:"Library",icon:e.jsx(V,{})}],Q=[{value:["sdi_group","workarea"],label:"Priorities",icon:e.jsx(R,{})}],Pe=[{value:["tag","theme"],label:"Tag & Theme",icon:e.jsx(de,{})}],U=[{value:["persons"],label:"Persons listings",icon:e.jsx(R,{})}],Y=[{value:["listing","structure"],label:"Structural",icon:e.jsx(ce,{})}],Re=[...Y,...z,j,...W,j,...G,...Q,j,...q,...H,...U,j,...E,j,...Pe],Ne=[{label:"Structure & Articles",menu:[...Y,...z]},{label:"Dossier & Priorities",menu:[...Q,...G]},{label:"Library",menu:[...W]},{label:"People",menu:[...q,...H,...U]},{label:"Countries & Regions",menu:[...E]}],$e=t=>t.map(({menu:s})=>s.reduce((n,{value:o})=>{let r=[...n,...o];return r.includes("dossier")&&!r.includes("dossier_sub")&&(r=[...r,"dossier_sub"]),r},[])),Xe=({collections:t,groupings:s=[],noOrdering:n=!1,onChange:o})=>{const{allow:r}=N().props,[v,f]=u.useState(),g=i=>{const m=t.filter(l=>l.id!==i);o(m)},x=i=>{var m,l;if(t.find(({id:p})=>p===i.id)){f({severity:"warning",message:"This collection is already in the context"});return}if((m=r==null?void 0:r.membership)!=null&&m.collection_types&&!(r.membership.collection_types.includes("*")||r.membership.collection_types.includes(i.type))){if(!((l=r.membership.collection_ids)!=null&&l.includes(i.id))){f({severity:"error",message:`You do not have permission to add a collection of type '${i.type}' to the context`});return}}f({severity:"success",message:"Collection added to context"}),i.type==="dossier"||i.type==="dossier_sub"||i.type==="workarea"?o([i,...t]):o([...t,i])},h=u.useMemo(()=>$e(s),[s]);return e.jsxs(e.Fragment,{children:[v&&e.jsx(ue,{open:!0,autoHideDuration:6e3,anchorOrigin:{vertical:"bottom",horizontal:"center"},onClose:()=>f(void 0),TransitionComponent:me,children:e.jsx(pe,{severity:v.severity,elevation:6,children:v.message})}),s.map(({label:i,menu:m},l)=>e.jsxs(b,{container:!0,spacing:0,alignItems:"baseline",children:[e.jsx(b,{item:!0,xs:2,children:e.jsx(y,{variant:"subtitle2",children:i})}),e.jsx(b,{item:!0,xs:1,children:e.jsx(L,{label:"Add",options:m,onPick:x})}),e.jsx(b,{item:!0,xs:9,children:e.jsx(S,{display:"flex",flexWrap:"wrap",children:t.filter(({type:p})=>h[l].find(c=>c===p)).map((p,c)=>e.jsx(he,{item:p,removeHandle:e.jsx(ve,{onClick:()=>g(p.id),size:"small",color:"secondary",children:e.jsx(X,{sx:{fontSize:"1rem"}})})},c))})}),e.jsx(b,{item:!0,xs:12,children:e.jsx(fe,{variant:"middle"})})]},l)),!n&&e.jsxs(e.Fragment,{children:[e.jsx(y,{variant:"h6",children:"Ordering"}),e.jsx(xe,{items:t,Renderer:O,onChange:o,variant:"row"})]}),e.jsx(L,{label:"Add collection",options:Re,onPick:i=>x(i)})]})};export{Xe as C,Ne as a,he as b};
