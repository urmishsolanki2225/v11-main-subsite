import{j as t,r}from"./client-ZKQMN23D.js";import{d as L}from"./dayjs.min-BIwLhz4I.js";import{f as x}from"./Content-CSTk_AN3.js";import{P as f}from"./PublishStatusIcon-CFRSoGcQ.js";import{B as b}from"./Box-CVOB97vC.js";import{T as p}from"./Typography-BOH_kjYl.js";import{l as k}from"./index.m-DI45-rQC.js";import{I as R}from"./app-Bt98msSn.js";import{m as T}from"./DataGridUtils-DqQ54bwL.js";import{a as Y,L as D}from"./Listing-BOo8Gk8o.js";import{u as M}from"./useDataSource-CV27kxAN.js";import{e as F}from"./MetaInfoManager-B6dBaBkB.js";const Q=({item:o,dragHandle:a,removeHandle:d,children:n})=>t.jsxs(b,{sx:{display:"flex",maxWidth:"100%",whiteSpace:"pre",alignItems:"baseline",borderRadius:1,borderStyle:"solid",borderWidth:1,borderColor:"divider",paddingLeft:0,paddingRight:1,marginRight:1,marginBottom:1,"&:hover":{backgroundColor:"#eee"}},children:[a,t.jsx(p,{variant:"body1",component:"span",sx:{flexGrow:2,textOverflow:"ellipsis",overflow:"hidden"},children:n||x(o)||"-untitled-"}),t.jsx(f,{item:o}),t.jsx(p,{variant:"caption",component:"span",sx:{flexBasis:"5%",flexShrink:0,ml:.5},children:o.id}),t.jsx(p,{variant:"caption",component:"span",sx:{flexBasis:"5%",flexShrink:0,ml:.5},children:L(o.publish_at).format("YYYY-MM-DD")}),t.jsx(p,{variant:"caption",component:"span",sx:{flexBasis:"10%",flexShrink:0,ml:.5},children:o.subtype||o.type}),d]}),V=({onPick:o,filter:a,sort:d,browserProps:n,extraFilter:g})=>{const{label:m}=n,[i,S]=r.useState(),[j,y]=r.useState(),[u,c]=r.useState(()=>({filter:{status:"published",...(a==null?void 0:a.filter)||{}}})),[v,w]=r.useState(m),[h,l]=r.useState(!1),C=M({mode:"xhr",search:j,filter:u,sort:d,xhrUrl:h?k("admin.items.index"):void 0}),B=e=>{l(!1),o(e)},I=[{field:"id",renderCell:e=>t.jsx(b,{display:"flex",justifyContent:"space-between",children:e.id}),align:"right",headerAlign:"right",width:60},{field:"title",renderCell:e=>t.jsxs("span",{children:[t.jsx(f,{item:e.row})," ",x(e.row)??"- no title -"]}),flex:4},{field:"type",valueGetter:e=>e.row.subtype||e.row.type},T(d==="publish_at"?"publish_at":"created_at")];r.useEffect(()=>{if(i!=null&&i.length){l(!0);const e=i.map(s=>s.join(",")).join(",");c(s=>({filter:{...s==null?void 0:s.filter,type:e}}))}else l(!1)},[i]),r.useEffect(()=>{c(e=>({filter:{...e==null?void 0:e.filter,...a==null?void 0:a.filter}}))},[a]);const E=[{label:"Hide unpublished",name:"status",value:"published"}];return t.jsx(F,{...n,options:n.options||[{value:R,label:"Items"}],filter:u,filterOptions:E,onChangeFilter:c,onSearch:y,onSelect:(e,s)=>{S([...e]),w(s!=null&&s.length?s[0].label:m)},onClose:()=>l(!1),dialog:{title:v??m,wide:!0,tall:!0},open:h,extraFilter:g,children:t.jsx(Y,{onSelect:e=>B(e),onCancel:()=>l(!1),children:t.jsx(D,{columns:I,dataSource:C,selectMode:"single"})})})};export{V as I,Q as a};
