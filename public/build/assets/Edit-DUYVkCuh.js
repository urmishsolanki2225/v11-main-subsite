import{j as e,r as o}from"./client-ZKQMN23D.js";import{d as p}from"./index-Cvft0mqj.js";import{d as z,a as J}from"./RestoreFromTrash-DbvhuAx3.js";import{d as K}from"./DeleteForever-CKlUOWKW.js";import{i as Q}from"./identifier-DHETMsl0.js";import{r as X,T as F}from"./Typography-BOH_kjYl.js";import{l as c}from"./index.m-DI45-rQC.js";import{C as I}from"./Confirm-DlxQ7D7t.js";import{S as B}from"./Section-BvcnflQ3.js";import{u as Y}from"./app-Bt98msSn.js";import{A as Z}from"./AppBarHeader-Bu_GnhUD.js";import{C as ee}from"./ContentScroll-BWeVEx1a.js";import{B as d}from"./Button-Bs2LlykX.js";import{G as n}from"./Grid-BYUzo7jW.js";import{T as M,F as te}from"./TextField-CXY6ukfK.js";import{F as O}from"./FormLabel-BgEYUhxt.js";import{I as W,S as k}from"./Select-DstqRMzc.js";import{M as w}from"./MenuItem-BvZfPpYr.js";import{B as _}from"./Box-CVOB97vC.js";import"./_commonjsHelpers-BosuxZz1.js";import"./browser-D9eauH0H.js";import"./index-edoyAQHv.js";import"./ButtonBase-B4crtf6-.js";import"./useSlotProps-O828vP2f.js";import"./index-BMQyuaGg.js";import"./extendSxProp-2i1zAAUV.js";import"./Grow--1bk2Oiz.js";import"./useTheme-CLvhDb73.js";import"./useThemeWithoutDefault-BU2aPzft.js";import"./Menu-BfV33fk6.js";import"./useFormControl-CO6OogGI.js";import"./GlobalStyles-BW4QefxH.js";import"./List-BgSNNkKU.js";import"./Stack-DUl2B3cg.js";import"./useThemeProps-DZ1rqyJn.js";import"./getThemeProps-BL5VHue0.js";import"./index-BqRrtboY.js";import"./dayjs.min-BIwLhz4I.js";import"./utc-BUuWioZ3.js";import"./ThemeProvider-BQTsL86O.js";import"./Close-mNv2SlFn.js";import"./ListItemIcon-CVfiqn-C.js";import"./ListItemText-7JFmWKqR.js";import"./Tooltip-CvPWsRqB.js";import"./Popper-1aVe17Xg.js";import"./InputAdornment-C1l6JSIr.js";import"./usePreviousProps-eB1Ppz6I.js";import"./SwitchBase-3IV-eDJc.js";var y={},ie=Q;Object.defineProperty(y,"__esModule",{value:!0});var D=y.default=void 0,ae=ie(X()),re=e;D=y.default=(0,ae.default)((0,re.jsx)("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 4-8 5-8-5V6l8 5 8-5z"}),"Email");const Ze=({userModel:t,errors:a,roles:A,can:r,subsite_edit:N})=>{var E,T,R;const{needSave:u,setNeedSave:x}=Y(),[h,v]=o.useState(t.name),[l,b]=o.useState(t.email),[s,S]=o.useState(t.role),[q,f]=o.useState(!1);let[m,j]=o.useState(t.subsite_id);o.useEffect(()=>{v(t.name),b(t.email),S(t.role),j(t.subsite_id)},[t]),o.useEffect(()=>{x(h!==t.name||l!==t.email||s!==t.role||m!==t.subsite_id),s=="subsiteadmin"&&m==null&&x(!1)},[x,t,h,l,s,m]),o.useEffect(()=>{s!="subsiteadmin"?(f(!1),j(null)):f(!0)},[s]);const H=()=>{v(t.name),b(t.email),S(t.role),j(t.subsite_id)},P=()=>{p.Inertia.patch(c("admin.users.update",{user:t}).toString(),{email:l,name:h,role:s,subsite_id:m},{preserveState:!0}),x(!1)},$=!!t.deleted_at,G=()=>{p.Inertia.post(c("admin.users.trash",{id:t.id}))},L=()=>{p.Inertia.post(c("admin.users.restore",{id:t.id}))},U=()=>{p.Inertia.delete(c("admin.users.destroy",{id:t.id}))},V=()=>{u||p.Inertia.post(c("admin.users.resetPassword",{user:t}),void 0,{preserveState:!0})};return e.jsxs(e.Fragment,{children:[e.jsxs(Z,{title:"Edit User",children:[e.jsx(d,{variant:"outlined",onClick:H,color:"secondary",disabled:!u,children:"Reset"}),e.jsx(d,{variant:u?"contained":"outlined",onClick:P,color:"secondary",disabled:!u,children:"Save"})]}),e.jsxs(ee,{children:[e.jsx(B,{title:"User details",open:!0,children:e.jsxs(n,{container:!0,children:[e.jsx(n,{item:!0,xs:12,children:e.jsx(M,{value:h,onChange:i=>v(i.target.value),label:"Name",variant:"outlined",fullWidth:!0,helperText:a==null?void 0:a.name})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(M,{value:l,onChange:i=>b(i.target.value),label:"Email address",variant:"outlined",fullWidth:!0,helperText:a==null?void 0:a.email})}),((E=r==null?void 0:r.role)==null?void 0:E.update)&&e.jsx(n,{item:!0,xs:6,children:e.jsxs(O,{variant:"outlined",fullWidth:!0,children:[e.jsx(W,{children:"Role"}),e.jsx(k,{value:s,onChange:i=>S(i.target.value),label:"Type",fullWidth:!0,children:Object.entries(A).map(([i,g],C)=>e.jsx(w,{value:i,children:g},C))}),e.jsx(te,{children:a==null?void 0:a.role})]})}),((T=r==null?void 0:r.subsite)==null?void 0:T.updateSubsite)&&s=="subsiteadmin"&&e.jsx(n,{item:!0,xs:6,children:e.jsx(_,{ml:2,children:e.jsxs(O,{variant:"outlined",fullWidth:!0,children:[e.jsx(W,{children:"Subsite name"}),e.jsx(k,{open:q,disabled:s!="subsiteadmin",onOpen:()=>f(!0),onClose:()=>f(!1),label:"Subsite Name",onChange:i=>j(i.target.value),value:m||"",fullWidth:!0,children:Object.entries(N[0]).map(([i,g],C)=>e.jsx(w,{value:i,children:g},C))})]})})})]})}),e.jsx(B,{title:"Actions",children:e.jsxs(n,{container:!0,spacing:4,alignItems:"baseline",children:[e.jsx(n,{item:!0,xs:12,children:e.jsxs(_,{display:"flex",flexDirection:"column",alignItems:"start",children:[e.jsx(F,{variant:"body1",children:"The password can be changed with a reset link that will be sent to the email address."}),e.jsx(d,{variant:"contained",disabled:l!==t.email,onClick:V,startIcon:e.jsx(D,{}),children:"Send reset link"}),e.jsx(F,{variant:"caption",children:l!==t.email?"Email address has changed, save first.":e.jsx("br",{})})]})}),((R=r==null?void 0:r.user)==null?void 0:R.delete)&&e.jsx(e.Fragment,{children:e.jsx(n,{item:!0,xs:12,children:e.jsx(_,{display:"flex",gap:2,children:$?e.jsxs(e.Fragment,{children:[e.jsx(I,{onConfirm:L,children:e.jsx(d,{variant:"contained",startIcon:e.jsx(z,{}),children:"Restore from Trash"})}),e.jsx(I,{onConfirm:U,children:e.jsx(d,{variant:"contained",color:"error",startIcon:e.jsx(K,{}),children:"Delete permanently"})})]}):e.jsx(e.Fragment,{children:e.jsx(I,{onConfirm:G,children:e.jsx(d,{variant:"contained",color:"primary",startIcon:e.jsx(J,{}),children:"Move to Trash"})})})})})})]})})]})]})};export{Ze as default};
