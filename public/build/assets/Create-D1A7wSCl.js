import{r as a,j as e}from"./client-ZKQMN23D.js";import{d as V}from"./index-Cvft0mqj.js";import{g as $}from"./_commonjsHelpers-BosuxZz1.js";import{_ as z}from"./_baseFlatten-7L3oGbN0.js";import{m as D}from"./map-BSSKY85Z.js";import{l as P}from"./index.m-DI45-rQC.js";import{u as B}from"./useDataSource-CV27kxAN.js";import{A as k}from"./Autocomplete-Byzw-jYA.js";import{T as q}from"./TextField-CXY6ukfK.js";import{g as U,a as H}from"./Autocomplete.renderers-DjUlWLdx.js";import{L as N}from"./LanguagePicker-DMYPmKx1.js";import{f as W}from"./Content-CSTk_AN3.js";import{F as I,a as G}from"./FormLabel-BgEYUhxt.js";import{R as J,a as K}from"./RadioGroup-DVoAhqow.js";import{F as Q}from"./FormControlLabel-Do0ozMLQ.js";import{B as R}from"./Button-Bs2LlykX.js";import"./app-Bt98msSn.js";import{A as X}from"./AppBarHeader-Bu_GnhUD.js";import{C as Y}from"./ContentScroll-BWeVEx1a.js";import{B as Z}from"./Box-CVOB97vC.js";import{P as ee}from"./List-BgSNNkKU.js";import{G as c}from"./Grid-BYUzo7jW.js";import{T as S}from"./Typography-BOH_kjYl.js";import{I as _,S as w}from"./Select-DstqRMzc.js";import{M as T}from"./MenuItem-BvZfPpYr.js";import"./browser-D9eauH0H.js";import"./index-edoyAQHv.js";import"./_baseIsEqual-DkReohVf.js";import"./_baseEach-DKAn15m2.js";import"./axios-DPCeRp2O.js";import"./global-Cavf3q2D.js";import"./index-BDIa4gQt.js";import"./identifier-DHETMsl0.js";import"./extendSxProp-2i1zAAUV.js";import"./useSlotProps-O828vP2f.js";import"./index-BMQyuaGg.js";import"./Menu-BfV33fk6.js";import"./useFormControl-CO6OogGI.js";import"./ButtonBase-B4crtf6-.js";import"./Grow--1bk2Oiz.js";import"./useTheme-CLvhDb73.js";import"./useThemeWithoutDefault-BU2aPzft.js";import"./GlobalStyles-BW4QefxH.js";import"./Close-mNv2SlFn.js";import"./Popper-1aVe17Xg.js";import"./usePreviousProps-eB1Ppz6I.js";import"./Sorter-D4ZFKmCa.js";import"./DragIndicator-CZ3Fox_H.js";import"./lodash-BYTxXjAY.js";import"./Confirm-DlxQ7D7t.js";import"./Stack-DUl2B3cg.js";import"./useThemeProps-DZ1rqyJn.js";import"./getThemeProps-BL5VHue0.js";import"./dayjs.min-BIwLhz4I.js";import"./FormGroup-BWakBykC.js";import"./Checkbox-jThM1nDo.js";import"./SwitchBase-3IV-eDJc.js";import"./index-BqRrtboY.js";import"./utc-BUuWioZ3.js";import"./ThemeProvider-BQTsL86O.js";import"./ListItemIcon-CVfiqn-C.js";import"./ListItemText-7JFmWKqR.js";import"./Tooltip-CvPWsRqB.js";import"./InputAdornment-C1l6JSIr.js";var te=z,re=D;function ie(u,m){return te(re(u,m),1)}var ae=ie;const oe=$(ae),se=({values:u,label:m,dataSource:p,enableOrdering:C=!1,autocompleteProps:i,onChange:v,getOptionLabel:s,renderOption:x,renderTagsSortable:d,groupBy:h,onlyChildTypes:b})=>{const[F,y]=a.useState(),[E,O]=a.useState([]),{paginatedData:o,childTypes:j}=B({pageSize:42,...p,mode:"xhr",search:F});return a.useEffect(()=>{if(!o||!o.data.length){O([]);return}let r=[...o.data];b&&(r=r.filter(({type:n})=>j==null?void 0:j.includes(n))),O(r)},[o,h,b,j]),e.jsx(k,{multiple:!0,value:u||[],options:E,filterOptions:r=>r,onChange:(r,n)=>v(n.filter(f=>typeof f!="string")),getOptionLabel:r=>typeof r=="string"?r:s(r),onInputChange:(r,n)=>{y(n)},renderInput:r=>e.jsx(q,{...r,label:m,fullWidth:!0,InputLabelProps:{shrink:!0}}),renderOption:(r,n,f)=>x?x(r,n,f):a.createElement("li",{...r,key:n.id},s(n)),isOptionEqualToValue:({id:r},{id:n})=>r===n,renderTags:C?(r,n)=>d?d(r,n,f=>console.warn("ToDo reordered",f)):void 0:void 0,groupBy:h,...i})},ne=({label:u,dataSource:m,onChange:p,showReset:C})=>{const[i,v]=a.useState(""),{paginatedData:s}=B({pageSize:42,...m,mode:"xhr"}),x=d=>{v(d);const h=s.data.find(b=>`${b.id}`===d);p(h?[h]:[])};return e.jsxs(I,{variant:"outlined",fullWidth:!0,children:[e.jsx(G,{children:u}),e.jsxs(J,{row:!0,value:i,onChange:d=>x(d.target.value),children:[s==null?void 0:s.data.map(d=>e.jsx(Q,{value:`${(d==null?void 0:d.id)||""}`,label:W(d)||"-untitled-",control:e.jsx(K,{})},d.id)),C&&e.jsx(R,{onClick:()=>x(""),disabled:!i,children:"clear"})]})]})},gt=({types:u,subtypes:m,collection:p,collection_prepick:C})=>{const[i,v]=a.useState(""),[s,x]=a.useState(""),[d,h]=a.useState(!1),[b,F]=a.useState(!1),[y]=a.useState(!0),[E,O]=a.useState([]),[o,j]=a.useState(),[r,n]=a.useState({}),[f,A]=a.useState([]),M=()=>{F(!1);const t={type:i,subtype:s,collection_ids:f.map(({id:l})=>l).filter(l=>!!l),languages:E||[]};y&&p&&(t.collection_id=p==null?void 0:p.id),V.Inertia.post(P("admin.items.store").toString(),t)},L=(t,l)=>{n(g=>({...g,[t]:l||[]}))};return a.useEffect(()=>{n(t=>{const l={};return o==null||o.forEach(({label:g})=>l[g]=t[g]||[]),l})},[o]),a.useEffect(()=>{A(oe(r))},[r]),a.useEffect(()=>{Object.entries(u).length===1&&v(Object.entries(u)[0][0])},[u]),a.useEffect(()=>{m[i]&&(h(!0),x(t=>m[i][t]?t:""))},[i,m]),a.useEffect(()=>{F(!!i&&(m[i]?!!s:!0)&&E.length>0&&(!(o!=null&&o.length)||f.length>0))},[i,s,m,E,o,f]),a.useEffect(()=>{const t=[...C[i]||[],...C.default||[]];s!=null&&s.startsWith("image")||i==="person"||i==="dev_coop_project"||i==="contact"?j([]):j(t||[])},[i,s,C]),e.jsxs(e.Fragment,{children:[e.jsx(X,{title:"Create Item"}),e.jsx(Y,{children:e.jsx(Z,{p:2,children:e.jsx(ee,{sx:{p:2},children:e.jsxs(c,{container:!0,spacing:2,children:[e.jsx(c,{item:!0,xs:12,children:e.jsxs(S,{variant:"body1",children:["Create an item of a specific type. Note that the type can ",e.jsx("strong",{children:"not"})," be changed later."]})}),e.jsx(c,{item:!0,xs:4,children:e.jsxs(I,{variant:"outlined",fullWidth:!0,children:[e.jsx(_,{children:"Type"}),e.jsx(w,{value:i,onChange:t=>v(t.target.value),label:"Type",fullWidth:!0,children:Object.entries(u).map(([t,l],g)=>e.jsx(T,{value:t,children:l},g))})]})}),e.jsx(c,{item:!0,xs:4,children:m[i]&&e.jsxs(I,{variant:"outlined",fullWidth:!0,children:[e.jsx(_,{children:"Subtype"}),e.jsx(w,{value:s,open:d,onChange:t=>x(t.target.value),disabled:!m[i],onClose:()=>h(!1),onOpen:()=>h(!0),label:"Subtype",fullWidth:!0,children:m[i]?e.jsx(T,{value:"",children:"required"})&&Object.entries(m[i]).map(([t,l],g)=>e.jsx(T,{value:t,children:l},g)):e.jsx(T,{value:"",children:"not applicable"})})]})}),e.jsxs(c,{item:!0,xs:12,children:[e.jsx(S,{variant:"h6",children:"Content languages"}),e.jsx(S,{variant:"body1",children:"Select the languages for which you will provide content now, others can be added later."})]}),e.jsx(c,{item:!0,xs:12,children:e.jsx(N,{onChange:O})}),p&&e.jsx(c,{item:!0,xs:12,children:e.jsxs(S,{variant:"body1",children:["This item will be created in the collection:"," ",e.jsx("strong",{children:W(p)})]})}),o!=null&&o.length?e.jsxs(e.Fragment,{children:[e.jsxs(c,{item:!0,xs:12,children:[e.jsx(S,{variant:"h6",children:"Collections for this item"}),e.jsx(S,{variant:"body1",children:"These are the most common collections in use, others can be added later."})]}),e.jsx(c,{item:!0,xs:12,container:!0,spacing:2,children:o==null?void 0:o.map(t=>e.jsx(c,{item:!0,xs:12,children:t.mode==="radio"?e.jsx(ne,{label:t.label,showReset:!0,dataSource:{xhrUrl:P("admin.collections.index"),filter:{filter:{...t.filter,status:"published"}},sort:"title"},onChange:l=>L(t.label,l)}):e.jsx(se,{label:t.label,values:r[t.label],autocompleteProps:{openOnFocus:!0},dataSource:{xhrUrl:P("admin.collections.index"),filter:{filter:{...t.filter,status:"published"}},sort:"title"},getOptionLabel:U,groupBy:t.groupByParent?H:void 0,onlyChildTypes:t.onlyChildTypes,onChange:l=>L(t.label,l)})},t.label))})]}):e.jsx(e.Fragment,{}),e.jsx(c,{item:!0,xs:12,children:e.jsx(R,{size:"large",variant:"contained",color:"primary",onClick:M,disabled:!b,children:"Create"})})]})})})})]})};export{gt as default};
