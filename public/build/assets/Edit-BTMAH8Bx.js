import{r as m,j as e}from"./client-ZKQMN23D.js";import{d as B,u as he}from"./index-Cvft0mqj.js";import{a as se,d as fe}from"./RestoreFromTrash-DbvhuAx3.js";import{d as xe}from"./DeleteForever-CKlUOWKW.js";import{f as ge,p as je,u as oe,g as H,L as ne,h as ve,R as U,i as be,k as W,S as z,l as _e,A as V,B as J,c as ae,j as le,D as ye,M as Ce,I as Se}from"./MetaInfoManager-B6dBaBkB.js";import{l as E}from"./index.m-DI45-rQC.js";import{u as N,V as Ie,D as we,d as Fe}from"./app-Bt98msSn.js";import{f as O,a as Te}from"./Content-CSTk_AN3.js";import{d as Re}from"./dayjs.min-BIwLhz4I.js";import"./Listing-BOo8Gk8o.js";import"./_baseIsEqual-DkReohVf.js";import{u as ke,S as A}from"./Section-BvcnflQ3.js";import{d as De}from"./Edit-BQczuObD.js";import{B as x}from"./Box-CVOB97vC.js";import{T as h}from"./Typography-BOH_kjYl.js";import{I as q}from"./List-BgSNNkKU.js";import{S as de}from"./Sorter-D4ZFKmCa.js";import{B as R}from"./Button-Bs2LlykX.js";import{a as Be,_ as Z}from"./identifier-DHETMsl0.js";import{g as Ee,a as Ae,c as Pe}from"./extendSxProp-2i1zAAUV.js";import{s as Le,u as Me,c as Ue}from"./useSlotProps-O828vP2f.js";import{T as We,a as G,b as $e}from"./TableRow-DuG98IK1.js";import{T as ze}from"./TableHead-BJyIqPnO.js";import{T}from"./TableCell-gutrWIi-.js";import{C as Ne,a as Oe}from"./CollectionsManager-PqOjCoQv.js";import{C as Y}from"./Confirm-DlxQ7D7t.js";import{g as ee}from"./useDataSource-CV27kxAN.js";import{G as _}from"./Grid-BYUzo7jW.js";import{T as j,F as $}from"./TextField-CXY6ukfK.js";import{M as te,P as M}from"./PlateFormControl-BeiDBqEU.js";import{F as re}from"./FormControlLabel-Do0ozMLQ.js";import{S as ie,A as X}from"./AppBarHeader-Bu_GnhUD.js";import{M as ce}from"./MenuItem-BvZfPpYr.js";import{d as me}from"./Close-C7klk6A2.js";import{I as ue}from"./InputFile-D_iUthKe.js";import{D as pe}from"./Dialog-CPjb0mTO.js";import{F as L}from"./FormLabel-BgEYUhxt.js";import{I as K,S as Ve}from"./Select-DstqRMzc.js";import{C as Ye}from"./ContentScroll-BWeVEx1a.js";import"./_commonjsHelpers-BosuxZz1.js";import"./browser-D9eauH0H.js";import"./index-edoyAQHv.js";import"./Menu-BfV33fk6.js";import"./useFormControl-CO6OogGI.js";import"./ButtonBase-B4crtf6-.js";import"./Grow--1bk2Oiz.js";import"./useTheme-CLvhDb73.js";import"./useThemeWithoutDefault-BU2aPzft.js";import"./GlobalStyles-BW4QefxH.js";import"./index-BMQyuaGg.js";import"./RemoveCircle-BP57RAS-.js";import"./Config-1Zk1eud0.js";import"./global-Cavf3q2D.js";import"./_baseEach-DKAn15m2.js";import"./cloneDeep-CpVDZSS9.js";import"./_baseFlatten-7L3oGbN0.js";import"./Add-CSI57y4_.js";import"./DialogTitle-DqHD2Xkp.js";import"./ListItemIcon-CVfiqn-C.js";import"./ListItemText-7JFmWKqR.js";import"./axios-DPCeRp2O.js";import"./index-BDIa4gQt.js";import"./Tooltip-CvPWsRqB.js";import"./Popper-1aVe17Xg.js";import"./Twitter-DyTnTSc8.js";import"./DataGridUtils-DqQ54bwL.js";import"./PublishStatusIcon-CFRSoGcQ.js";import"./ColorPickerInput-B-O6o-Qw.js";import"./map-BSSKY85Z.js";import"./index-D3ylJrlI.js";import"./InputAdornment-C1l6JSIr.js";import"./useMediaQuery--fqye5PE.js";import"./getThemeProps-BL5VHue0.js";import"./index-BqRrtboY.js";import"./utc-BUuWioZ3.js";import"./ThemeProvider-BQTsL86O.js";import"./useThemeProps-DZ1rqyJn.js";import"./Close-mNv2SlFn.js";import"./Stack-DUl2B3cg.js";import"./CircularProgress-CKHSwoEO.js";import"./toPropertyKey-PLuKRk1e.js";import"./Autocomplete-Byzw-jYA.js";import"./usePreviousProps-eB1Ppz6I.js";import"./Checkbox-jThM1nDo.js";import"./SwitchBase-3IV-eDJc.js";import"./DragIndicator-CZ3Fox_H.js";import"./lodash-BYTxXjAY.js";import"./DataCellCollectionTree-CJhNu20T.js";import"./Autocomplete.renderers-DjUlWLdx.js";import"./AutocompleteSingle-0vSJMg5_.js";function He(t){return Ee("MuiTableContainer",t)}Ae("MuiTableContainer",["root"]);const Je=["className","component"],qe=t=>{const{classes:i}=t;return Ue({root:["root"]},He,i)},Xe=Le("div",{name:"MuiTableContainer",slot:"Root",overridesResolver:(t,i)=>i.root})({width:"100%",overflowX:"auto"}),Ke=m.forwardRef(function(i,r){const n=Me({props:i,name:"MuiTableContainer"}),{className:o,component:u="div"}=n,a=Be(n,Je),d=Z({},n,{component:u}),l=qe(d);return e.jsx(Xe,Z({ref:r,as:u,className:Pe(l.root,o),ownerState:d},a))}),Qe=t=>{B.Inertia.get(E("admin.items.edit",{id:t}).toString(),{})},Ze=({item:t,dragHandle:i,removeHandle:r})=>{var o;const n=t.item.type==="resource";return e.jsxs(x,{sx:{display:"flex",width:"100%",alignItems:"center",borderBottomStyle:"solid",borderBottomWidth:1,borderColor:"divider",paddingBottom:.5,paddingTop:.5,"&:first-child":{borderTopWidth:1,borderTopStyle:"solid"}},children:[i,e.jsx(h,{variant:"body1",sx:{flexBasis:"25%",flexShrink:0,flexGrow:2,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"pre"},children:O(t.item)??t.item.contents[0].title??"-untitled-"}),e.jsx(x,{children:(o=t.item.contents)==null?void 0:o.map(({lang:u})=>u).join(",")}),e.jsx(q,{size:"small",onClick:()=>{Qe(t.item.id)},color:"secondary",children:e.jsx(De,{sx:{fontSize:"1rem"}})}),n&&e.jsx(x,{sx:{flexBasis:"25%",flexShrink:0,flexGrow:2,overflow:"hidden",marginLeft:1,marginRight:1},children:e.jsx(ge,{item:t.item})}),e.jsx(h,{variant:"caption",sx:{flexBasis:"8%",flexShrink:0},children:t.item.subtype?t.item.subtype:t.item.type}),r]})},Ge=({item:t,dragHandle:i,removeHandle:r,onChange:n})=>{const[o,u]=m.useState(t.label||""),a=()=>{n&&n({...t,label:o})};return e.jsxs(x,{sx:{display:"flex",whiteSpace:"pre",alignItems:"baseline",borderRadius:1,borderStyle:"solid",borderWidth:1,borderColor:"divider",paddingLeft:i?0:1,paddingRight:1,margin:.5},children:[i,e.jsx(x,{sx:{flexBasis:"25%",flexShrink:0,flexGrow:2,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"pre"},children:e.jsx(j,{value:o,placeholder:"Label",onChange:d=>u(d.target.value),fullWidth:!0,margin:"dense",variant:"standard",onBlur:a,size:"small"})}),e.jsx(h,{variant:"body2",sx:{flexBasis:"25%",flexShrink:0,flexGrow:4,overflow:"hidden",marginLeft:1,marginRight:1},children:t.original_filename}),r]})},et=["phone_main","phone_other","phone_other2","fax_main","fax_other","website","email","email_other","street1","street2","street3","zip","city","state","country_code"],tt=({content:t,onChange:i})=>{const[r,n]=m.useState(t!=null&&t.contacts&&(t!=null&&t.contacts[0])?t==null?void 0:t.contacts[0]:void 0);m.useEffect(()=>{n(t==null?void 0:t.contacts[0])},[t.contacts]);const o=(a,d)=>{n(l=>({...l,[a]:d}))},u=()=>{r!==(t==null?void 0:t.contacts[0])&&i("contacts",[r])};return r?e.jsxs(_,{container:!0,spacing:1,children:[e.jsx(_,{item:!0,xs:12,children:e.jsx(h,{variant:"h6",children:"Contact card"})}),et.map((a,d)=>e.jsx(_,{item:!0,xs:4,children:e.jsx(j,{value:r[a]??"",label:je(a),variant:"outlined",fullWidth:!0,onChange:l=>o(a,l.target.value),onBlur:u,margin:"dense",InputLabelProps:{shrink:!0}})},d))]}):e.jsx(h,{children:"No contact details found."})},rt=({content:t,onChange:i})=>{const[r,n]=m.useState(t.dev_coop_project),[o,u]=m.useState(()=>(r==null?void 0:r.partners.filter(({role:s})=>s==="benefitting"))||[]),[a,d]=m.useState(()=>(r==null?void 0:r.partners.filter(({role:s})=>s==="dev_coop"))||[]);m.useEffect(()=>{n(t==null?void 0:t.dev_coop_project)},[t.dev_coop_project]),m.useEffect(()=>{n(s=>{if(!s)return s;const g=[...o,...a].map(v=>{const S={...v};return delete S.country_name,S});return{...s,partners:g}})},[o,a]);const l=({benefitting:s=o,coop:g=a})=>{const v=[...s,...g].map(F=>{const k={...F};return delete k.country_name,k}),S={...r,partners:v};u(s),d(g),i("dev_coop_project",S)},c=m.useCallback((s,g)=>{n(v=>v?v[s]===g?v:{...v,[s]:g}:{[s]:g})},[]),w=s=>{i("dev_coop_project",r&&{...r,is_reviewed:s})},y=s=>{i("dev_coop_project",r&&{...r,regional:!!s})},p=()=>{r!==t.dev_coop_project&&i("dev_coop_project",r)};return r?e.jsx(_,{container:!0,spacing:1,children:e.jsxs(_,{item:!0,xs:12,children:[e.jsx(h,{variant:"h6",children:"Development cooperation project"}),e.jsx(re,{control:e.jsx(ie,{checked:!!r.is_reviewed,onChange:(s,g)=>{w(g)}}),label:"Reviewed by EiiE staff"}),e.jsx(re,{control:e.jsx(ie,{checked:!!r.regional,onChange:(s,g)=>{y(g)}}),label:"Regional Project"}),e.jsx(h,{variant:"h6",children:"Implementing Organizations"}),e.jsx(te,{role:"benefitting",onChange:s=>l({benefitting:s}),initialPartners:o,adminMode:!0}),e.jsx(h,{variant:"h6",children:"Cooperation Partners"}),e.jsx(te,{role:"dev_coop",onChange:s=>l({coop:s}),initialPartners:a,adminMode:!0}),e.jsx(h,{variant:"h6",children:"Project details (public)"}),e.jsxs(_,{container:!0,spacing:2,children:[e.jsx(_,{item:!0,xs:6,children:e.jsx(j,{value:r.year_start??"",label:"Year started",onChange:s=>c("year_start",parseInt(s.target.value)),onBlur:p,margin:"dense"})}),e.jsx(_,{item:!0,xs:6,children:e.jsx(j,{value:r.year_end??"",label:"Year ended",onChange:s=>c("year_end",parseInt(s.target.value)),onBlur:p,margin:"dense"})})]}),e.jsx(j,{value:r.url??"",label:"URL",onChange:s=>c("url",s.target.value),onBlur:p}),e.jsx(j,{value:r.public_email??"",label:"Published Email Address",onChange:s=>c("public_email",s.target.value),onBlur:p}),e.jsx(M,{label:"Description",onChange:s=>c("description",JSON.stringify(s)),initialValueAsText:r.description,FormControlProps:{margin:"dense",onBlur:p}}),e.jsx(M,{label:"Objectives",onChange:s=>c("objectives",JSON.stringify(s)),initialValueAsText:r.objectives,FormControlProps:{margin:"dense",onBlur:p}}),e.jsx(M,{label:"Activities",onChange:s=>c("activities",JSON.stringify(s)),initialValueAsText:r.activities,FormControlProps:{margin:"dense",onBlur:p}}),e.jsx(M,{label:"Outcomes",onChange:s=>c("outcomes",JSON.stringify(s)),initialValueAsText:r.outcomes,FormControlProps:{margin:"dense",onBlur:p}}),e.jsx(h,{variant:"h6",children:"Additional information (not public)"}),e.jsx(j,{value:r.contact_name??"",label:"Contact Person",onChange:s=>c("contact_name",s.target.value),onBlur:p}),e.jsx(j,{value:r.contact_email??"",label:"Contact Email",onChange:s=>c("contact_email",s.target.value),onBlur:p}),e.jsx(j,{value:r.funding??"",label:"Funding",onChange:s=>c("funding",s.target.value),onBlur:p}),e.jsxs(x,{display:"flex",gap:2,children:[e.jsx(j,{select:!0,hiddenLabel:!0,fullWidth:!0,value:r.budget_currency,onChange:s=>c("budget_currency",s.target.value),sx:{width:60},children:["€","$"].map(s=>e.jsx(ce,{value:s,children:s},s))}),e.jsx(j,{value:r.budget_amount||"",onChange:s=>c("budget_amount",parseInt(s.target.value)||0),label:"Budget"})]}),e.jsx(j,{value:r.remark_internal??"",label:"Remarks",onChange:s=>c("remark_internal",s.target.value),onBlur:p})]})}):e.jsx(h,{color:"error",children:"No development cooperation project info found, this is an error."})},it=({content:t,onChange:i})=>{const[r,n]=m.useState(t==null?void 0:t.embeds);m.useEffect(()=>{n(t.embeds)},[t.embeds]);const o=(a,d,l)=>{n(c=>[{...c[0],[d]:l},...c.slice(1)])},u=()=>{r!==t.embeds&&i("embeds",r)};return r!=null&&r.length?e.jsxs(e.Fragment,{children:[e.jsx(h,{variant:"h6",children:"Embed social"}),r.map((a,d)=>e.jsx(_,{container:!0,spacing:2,children:e.jsx(_,{item:!0,xs:12,children:e.jsx(j,{value:a.post_url||"",label:"Social Media Post URL",variant:"outlined",fullWidth:!0,onChange:l=>o(0,"post_url",l.target.value),onBlur:u})})},d))]}):e.jsx(h,{color:"error",children:"No post url found, this is an error."})},st=({content:t,onChange:i})=>{const[r,n]=m.useState(""),o=m.useRef(null),[u,a]=m.useState(!1),{needSave:d}=N(),[l,c]=m.useState(!1),{post:w,result:y,errors:p,progress:s,isBusy:g,reset:v}=oe(),S=()=>{var b,I;a(!!((I=(b=o.current)==null?void 0:b.files)!=null&&I.length))},F=()=>{var I,f;if(a(!1),!((f=(I=o.current)==null?void 0:I.files)!=null&&f.length)||!t.id)return;const b=new FormData;b.set("label",r),b.set("content_id",`${t.id}`),b.append("files[]",o.current.files[0]),w(E("admin.resourceitem.file.upload"),b)},k=b=>{i("files",b)};m.useEffect(()=>{y!=null&&y.success&&(B.Inertia.reload(),c(!1))},[y]),m.useEffect(()=>{l&&v()},[l,v]);const D=!t.id||d;return e.jsxs(e.Fragment,{children:[e.jsx(h,{variant:"h6",children:"Files"}),e.jsxs(x,{display:"flex",flexDirection:"row",justifyContent:"flex-start",alignItems:"center",marginBottom:2,children:[e.jsx(R,{disabled:D,onClick:()=>c(!0),variant:"outlined",children:"Add file"}),D&&e.jsx(h,{variant:"body2",color:"textSecondary",marginLeft:2,children:"First save before adding files"})]}),t.files.filter(({label:b})=>!b).length>1&&e.jsx(h,{variant:"body2",color:"warning",children:"Note: there are multiple files without a label, this might be confusing for visitors of the website. Please provide labels for each file."}),t.files.length>0&&e.jsx(de,{items:t.files,onChange:k,Renderer:Ge}),l&&e.jsxs(pe,{open:!0,maxWidth:"md",onClose:()=>!g&&c(!1),children:[e.jsx(X,{title:`Add file for ${t.lang.toUpperCase()}`,isDialog:!0,children:e.jsx(q,{edge:"end",color:"inherit",disabled:g,onClick:()=>c(!1),"aria-label":"close",size:"large",children:e.jsx(me,{})})}),e.jsxs(x,{display:"flex",flexDirection:"column",justifyContent:"space-between",padding:2,children:[e.jsx(j,{fullWidth:!0,variant:"outlined",label:"Label",value:r,onChange:b=>n(b.target.value),error:!!(p!=null&&p.label),InputLabelProps:{shrink:!0},helperText:(p==null?void 0:p.label)||"optional, but needed when there are multiple files"}),e.jsxs(L,{variant:"outlined",fullWidth:!0,error:!!(p!=null&&p.files),children:[e.jsx(K,{shrink:!0,children:"File"}),e.jsx(ue,{label:"File",ref:o,onChange:S}),e.jsx($,{children:(p==null?void 0:p.files)||" "})]}),e.jsxs(L,{fullWidth:!0,children:[e.jsx(R,{disabled:!u||d,onClick:F,startIcon:e.jsx(H,{}),color:"primary",variant:"contained",children:"Upload"}),e.jsx($,{children:d?"Save the item before adding uploads":" "})]}),e.jsx(x,{margin:-2,marginTop:2,children:e.jsx(ne,{variant:"determinate",value:s?s*100:0})})]})]})]})},ot=({itemSubtype:t,content:i,onChange:r})=>{const n=ke(),o=m.useRef(null),[u,a]=m.useState(!1),[d,l]=m.useState(),{post:c,result:w,errors:y,reset:p,isBusy:s,progress:g}=oe(),[v,S]=m.useState(!1),{needSave:F}=N();m.useEffect(()=>{w!=null&&w.success&&(B.Inertia.reload(),S(!1))},[w]);const k=f=>{const C=Te(f,n)||f.contents[0];C!=null&&C.images.length?r("images",[{path:C.images[0].path}]):console.log("no image in picked item, shouldnt happen",n,C,f)},D=()=>{var f,C,P,Q;(C=(f=o.current)==null?void 0:f.files)!=null&&C.length&&o.current.files[0].size>10*1024*1024?l(Math.round(o.current.files[0].size/(1024*1024)*10)/10):l(void 0),a(!!((Q=(P=o.current)==null?void 0:P.files)!=null&&Q.length))},b=()=>{var C,P;if(!((P=(C=o.current)==null?void 0:C.files)!=null&&P.length)||!i.id)return;a(!1);const f=new FormData;f.set("content_id",`${i.id}`),f.append("file",o.current.files[0]),c(E("admin.resourceitem.image.replace"),f)};m.useEffect(()=>{v&&p()},[v,p]);const I=!i.id||F;return e.jsxs(e.Fragment,{children:[e.jsx(h,{variant:"body2",children:"The Subtitle field will be used as caption, if present."}),e.jsx(h,{variant:"h6",children:"Image"}),e.jsxs(x,{display:"flex",flexDirection:"row",children:[e.jsx(ve,{imageResource:i.images[0],imageType:t,imageOnly:!0,sx:{width:"100%",maxWidth:350,mr:2,mb:1}}),e.jsx(x,{display:"flex",flexDirection:"column",alignItems:"flex-start",children:i.id?e.jsxs(e.Fragment,{children:[e.jsx(h,{variant:"body2",marginBottom:1,children:"Replace image for this language, either by picking an existing image or uploading a new file."}),e.jsx(U,{label:"Find existing image",onPick:k,menu:[be],buttonProps:{color:"primary",variant:"outlined",size:"medium"}}),e.jsxs(x,{display:"flex",flexDirection:"column",justifyContent:"flex-start",alignItems:"start",marginTop:1,padding:0,children:[e.jsx(R,{disabled:I,onClick:()=>S(!0),variant:"outlined",startIcon:e.jsx(H,{}),children:"Upload a new file"}),I&&e.jsx(h,{variant:"body2",color:"textSecondary",children:"First save before uploading a new image file"})]})]}):e.jsx(h,{variant:"body1",children:"Save item first in order to replace the image."})})]}),v&&e.jsxs(pe,{open:!0,maxWidth:"md",onClose:()=>!s&&S(!1),children:[e.jsx(X,{title:`Upload new image for ${i.lang.toUpperCase()}`,isDialog:!0,children:e.jsx(q,{edge:"end",color:"inherit",disabled:s,onClick:()=>S(!1),"aria-label":"close",size:"large",children:e.jsx(me,{})})}),e.jsxs(x,{display:"flex",flexDirection:"column",justifyContent:"space-between",padding:2,children:[e.jsxs(L,{variant:"outlined",fullWidth:!0,error:!!(y!=null&&y.files),children:[e.jsx(K,{shrink:!0,children:"File"}),e.jsx(ue,{label:"File",ref:o,accept:"image/*",onChange:D}),e.jsx($,{children:(y==null?void 0:y.files)||(d?`Large file: ${d}MB`:" ")})]}),e.jsxs(L,{fullWidth:!0,children:[e.jsx(R,{disabled:!u||F,onClick:b,startIcon:e.jsx(H,{}),color:d?"warning":"primary",variant:"contained",children:"Upload"}),e.jsx($,{children:F?"Save the item before adding uploads":" "})]}),e.jsx(x,{margin:-2,marginTop:2,children:e.jsx(ne,{variant:"determinate",value:g?g*100:0})})]})]})]})},nt=({content:t,onChange:i})=>{const[r,n]=m.useState(t==null?void 0:t.links);m.useEffect(()=>{n(t.links)},[t.links]);const o=(a,d,l)=>{n(c=>[{...c[0],[d]:l},...c.slice(1)])},u=()=>{r!==t.links&&i("links",r)};return r!=null&&r.length?e.jsxs(e.Fragment,{children:[e.jsx(h,{variant:"h6",children:"Link resource"}),r.map((a,d)=>e.jsxs(_,{container:!0,spacing:2,children:[e.jsx(_,{item:!0,xs:4,children:e.jsx(j,{value:a.label||"",label:"Label",variant:"outlined",fullWidth:!0,onChange:l=>o(0,"label",l.target.value),onBlur:u})}),e.jsx(_,{item:!0,xs:8,children:e.jsx(j,{value:a.url||"",label:"URL",variant:"outlined",fullWidth:!0,onChange:l=>o(0,"url",l.target.value),onBlur:u})})]},d))]}):e.jsx(h,{color:"error",children:"No link found, this is an error."})},at=({content:t,onChange:i})=>{const[r,n]=m.useState(t==null?void 0:t.videos);m.useEffect(()=>{n(t.videos)},[t.videos]);const o=(a,d,l)=>{n(c=>[{...c[0],[d]:l},...c.slice(1)])},u=()=>{r!==t.videos&&i("videos",r)};return r!=null&&r.length?e.jsxs(e.Fragment,{children:[e.jsx(h,{variant:"h6",children:"Video resource"}),r.map((a,d)=>e.jsxs(_,{container:!0,spacing:2,children:[e.jsx(_,{item:!0,xs:6,children:e.jsxs(L,{variant:"outlined",fullWidth:!0,children:[e.jsx(K,{children:"Provider"}),e.jsx(Ve,{value:a.provider,onChange:l=>o(0,"provider",l.target.value),label:"Provider",fullWidth:!0,children:Ie.map((l,c)=>e.jsx(ce,{value:l,children:l},c))})]})}),e.jsx(_,{item:!0,xs:6,children:e.jsx(j,{value:a.provider_id||"",label:"ID",variant:"outlined",fullWidth:!0,onChange:l=>o(0,"provider_id",l.target.value),onBlur:u})})]},d))]}):e.jsx(h,{color:"error",children:"No video details found, this is an error."})},lt=t=>{switch(t.type){case"dev_coop_project":return rt;case"contact":case"person":return t.contents.length&&t.contents[0].contacts?tt:void 0}switch(t.subtype){case"link":return nt;case"image":case"image.icon":case"image.portrait":case"image.square":return ot;case"file":return st;case"video":return at;case"embed":return it;default:return}},dt=({item:t})=>{const i=t.collections||[],r=[];return t.type==="resource"&&W(t)&&r.push({title:"Image resource",text:e.jsxs(e.Fragment,{children:["Image for ",e.jsx("strong",{children:t.image_for_items_count??0})," ","items",e.jsx("br",{}),"and for"," ",e.jsx("strong",{children:t.image_for_collections_count??0})," ","collections"]})}),r.push({title:"Level of contextualization",text:e.jsxs(e.Fragment,{children:["This item is part of ",e.jsx("strong",{children:i.length})," ",i.length===1?"collection":"collections","."]})}),r.push({title:"Collection ordering",text:e.jsx(e.Fragment,{children:i.length?i.slice(0,3).map(n=>O(n)).join(", ")+", ...":e.jsx(e.Fragment,{children:"- no collections -"})})}),e.jsx(z,{contents:r})},ct=t=>t!=null&&t.length?"Item has attachments":"No attachments",mt=t=>t!=null&&t.length?t.reduce((i,{attachments:r})=>i+r.length,0):0,ut=t=>{const i=mt(t);if(i)return t.length===1?i==1?`${i} attachment.`:`${i} attachments.`:`A total of ${i} attachments in ${t.length} groups.`},pt=({attachmentGroups:t})=>{const i=_e(),r=(a,d,l)=>{i({type:"attachmentgroup_update",index:a,field:d,value:l})},n=a=>{i({type:"attachmentgroup_remove",index:a})},o=()=>{i({type:"attachmentgroup_add"})},u=(a,d)=>{i({type:"attachment_add",groupIndex:a,attachedItem:d})};return e.jsxs(A,{title:"Attachments",summary:e.jsx(z,{contents:[{title:ct(t),text:ut(t)},{title:"Add attachment",text:(t==null?void 0:t.length)>1?"Open the panel to add an attachment to a group.":void 0,component:(t==null?void 0:t.length)>1?void 0:e.jsx(U,{label:"Attachment",menu:V,onPick:a=>{u(void 0,a)}})}]}),children:[e.jsx(h,{variant:"body1",children:"Attachments are grouped, where each group can optionally have a title and a blurb."}),t.map((a,d)=>e.jsxs(x,{display:"flex",flexDirection:"column",children:[e.jsxs(x,{display:"flex",flexDirection:"row",children:[e.jsx(x,{flexGrow:2,children:e.jsx(h,{variant:"h6",children:O(a)||"-untitled-"})}),e.jsx(J,{color:"secondary",onConfirm:()=>n(d),icon:e.jsx(se,{}),buttonProps:{size:"small"},children:"Removing attachment group can not be undone."})]}),e.jsx(ae,{contents:a.contents,fields:["title","blurb"],onChange:l=>r(d,"contents",l)}),e.jsx(de,{items:a.attachments,Renderer:Ze,onChange:l=>r(d,"attachments",l),getId:l=>l.item.id}),e.jsx(x,{children:e.jsx(U,{label:"Attachment",menu:V,onPick:l=>{u(d,l)}})}),e.jsx(we,{variant:"middle"})]},d)),(t==null?void 0:t.length)===0?e.jsx(U,{label:"Attachment",menu:V,onPick:a=>{u(void 0,a)}}):e.jsx(R,{onClick:o,startIcon:e.jsx(Fe,{}),color:"secondary",size:"small",children:"Attachment Group"})]})},ht=t=>[...t.main,...t.contents.flatMap(({lang:i,audits:r})=>r.map(n=>({...n,lang:i})))].sort((i,r)=>i.created_at>r.created_at?-1:1),ft=()=>{const{audits:t}=he().props,i=t?ht(t):[];return e.jsx(A,{title:"Audit",summary:e.jsx(z,{contents:[{title:"Recent audits",text:`${i.length||0} changes recorded`}]}),children:e.jsx(Ke,{children:e.jsxs(We,{size:"small",children:[e.jsx(ze,{children:e.jsxs(G,{children:[e.jsx(T,{children:"Timestamp"}),e.jsx(T,{children:"User"}),e.jsx(T,{children:"Event"}),e.jsx(T,{children:"Lang"}),e.jsx(T,{children:"Fields"})]})}),e.jsx($e,{children:i.map(r=>{var n;return e.jsxs(G,{children:[e.jsx(T,{style:{whiteSpace:"pre"},children:Re(r.created_at).format("YYYY-MM-DD HH:mm")}),e.jsx(T,{style:{whiteSpace:"pre"},children:((n=r.user)==null?void 0:n.name)??""}),e.jsx(T,{children:r.event}),e.jsx(T,{children:r.lang||""}),e.jsx(T,{children:Object.keys(r.new_values).join(", ")})]},r.id)})})]})})})},xt=({item:t})=>{const{needSave:i}=N();return e.jsxs(x,{children:["This image resource is used for"," ",t.image_for_items_count?e.jsx(J,{label:`${t.image_for_items_count} items`,color:"primary",needConfirmation:i,onConfirm:()=>{ee("admin.items.index",{filter:{"imageitem.id":t.id}})},variant:"outlined"}):e.jsx(e.Fragment,{children:"0 items"})," ","and for"," ",t.image_for_collections_count?e.jsx(J,{label:`${t.image_for_collections_count} collections`,color:"primary",needConfirmation:i,onConfirm:()=>{ee("admin.collections.index",{filter:{"imageitem.id":t.id}})},variant:"outlined"}):e.jsx(e.Fragment,{children:"0 collections"})]})},gt=(t,i)=>{var n;let r;if(i.type==="patch")r={...t,[i.field]:i.value};else if(i.type==="item_reset")r=i.item;else if(i.type==="attachmentgroup_update")r={...t,attachment_groups:t.attachment_groups.map((o,u)=>u===i.index?{...o,[i.field]:i.value}:o)};else if(i.type==="attachmentgroup_add")r={...t,attachment_groups:[...t.attachment_groups,{id:0,order:t.attachment_groups.length,contents:[],attachments:[]}]};else if(i.type==="attachmentgroup_remove"){const o=[...t.attachment_groups];o.splice(i.index,1),r={...t,attachment_groups:o}}else if(i.type==="attachment_add")if(i.groupIndex===void 0&&!((n=t.attachment_groups)!=null&&n.length))r={...t,attachment_groups:[{id:0,order:0,contents:[],attachments:[{id:0,order:0,item:i.attachedItem}]}]};else{(!i.groupIndex||i.groupIndex>=t.attachment_groups.length)&&(i.groupIndex=0);const o={...t.attachment_groups[i.groupIndex]};o.attachments=[...o.attachments,{id:0,order:o.attachments.length||0,item:i.attachedItem}];const u=[...t.attachment_groups];u[i.groupIndex]=o,r={...t,attachment_groups:u}}else console.warn("invalid reducer action",i),r=t;return le.diff(r,t)?r:t},ei=({item:t,can:i})=>{var v,S,F,k,D,b,I;const[r,n]=m.useReducer(gt,t),[o,u]=m.useState(),{needSave:a,setNeedSave:d}=N(),l=()=>{B.Inertia.patch(E("admin.items.update",{item:r}).toString(),o,{preserveState:!1,replace:!0,onFinish:()=>{r.type==="dev_coop_project"&&window.location.reload()}}),d(!1)},c=()=>{n({type:"item_reset",item:t})},w=m.useCallback(f=>{n({type:"patch",field:"contents",value:f})},[]),y=!!r.deleted_at,p=()=>{B.Inertia.post(E("admin.items.trash",{id:r.id}))},s=()=>{B.Inertia.post(E("admin.items.restore",{id:r.id}))},g=()=>{B.Inertia.delete(E("admin.items.destroy",{id:r.id}))};return m.useEffect(()=>{d(!!o)},[o,d]),m.useEffect(()=>{n({type:"item_reset",item:t})},[t]),m.useEffect(()=>{u(le.diff(t,r))},[t,r]),e.jsxs(ye,{dispatch:n,children:[e.jsxs(X,{title:"Edit Item",children:[e.jsx(R,{variant:"outlined",onClick:c,color:"secondary",disabled:!a,children:"Reset"}),e.jsx(R,{variant:a?"contained":"outlined",onClick:l,color:"secondary",disabled:!a,children:"Save"})]}),e.jsx(Ye,{children:e.jsxs("form",{autoComplete:"off",autoCapitalize:"off",children:[e.jsx(x,{padding:2,children:e.jsx(h,{variant:"h4",children:O(r)||((v=r.contents.at(0))==null?void 0:v.title)||"-no title-"})}),e.jsx(Ce,{item:r}),r.type==="activityreport_congress"&&e.jsx(A,{title:"Report to World Congress",open:!0,children:e.jsxs(x,{display:"flex",gap:2,children:[e.jsx(j,{label:"Year from",value:((S=r.activity_report_congress)==null?void 0:S.year_from)||"",onChange:f=>{const C=parseInt(f.currentTarget.value)||0;n({type:"patch",field:"activity_report_congress",value:{...r.activity_report_congress,year_from:C}})}}),e.jsx(j,{label:"Year to",value:((F=r.activity_report_congress)==null?void 0:F.year_to)||"",onChange:f=>{const C=parseInt(f.currentTarget.value)||0;n({type:"patch",field:"activity_report_congress",value:{...r.activity_report_congress,year_to:C}})}})]})}),e.jsx(A,{title:"Contents",open:!0,summary:e.jsx(z,{contents:[{title:"Languages",text:((k=r.contents)==null?void 0:k.map(({lang:f})=>f).join(", "))||"No content"}]}),children:e.jsx(ae,{contents:r.contents,fields:r.type==="contact"?["title","subtitle","blurb"]:r.type==="dev_coop_project"?["title"]:["title","subtitle","blurb","content"],htmlFields:{content:"full",blurb:"limited"},itemSubtype:r.subtype,additionalEditor:lt(r),onChange:w})}),e.jsxs(A,{title:"Context",summary:e.jsx(dt,{item:r}),children:[W(r)&&e.jsx(xt,{item:r}),e.jsx(Ne,{collections:r.collections??[],groupings:Oe,onChange:f=>n({type:"patch",field:"collections",value:f})})]}),!W(r)&&e.jsx(Se,{images:r.all_images,support_color:r.support_color}),!W(r)&&r.subtype!=="file"&&e.jsx(pt,{attachmentGroups:r.attachment_groups}),e.jsx(ft,{}),e.jsx(A,{title:"Actions",children:e.jsx(x,{display:"flex",gap:2,children:y?e.jsxs(e.Fragment,{children:[((D=i==null?void 0:i.items)==null?void 0:D.restoreMany)&&e.jsx(Y,{onConfirm:s,children:e.jsx(R,{variant:"contained",startIcon:e.jsx(fe,{}),children:"Restore from Trash"})}),((b=i==null?void 0:i.items)==null?void 0:b.forceDeleteMany)&&e.jsx(Y,{onConfirm:g,children:e.jsx(R,{variant:"contained",color:"error",startIcon:e.jsx(xe,{}),children:"Delete permanently"})})]}):e.jsx(e.Fragment,{children:((I=i==null?void 0:i.items)==null?void 0:I.deleteMany)&&e.jsx(Y,{onConfirm:p,children:e.jsx(R,{variant:"contained",color:"primary",startIcon:e.jsx(se,{}),children:"Move to Trash"})})})})}),!1]})})]})};export{ei as default};
