import{r as u,j as e}from"./client-ZKQMN23D.js";import{d as D,u as he}from"./index-BmtA0KFl.js";import{a as ie,d as fe}from"./RestoreFromTrash-BSEz2N4A.js";import{d as xe}from"./DeleteForever-Dtg3yl_d.js";import{g as ge,p as je,u as ne,d as ae,h as H,L as oe,i as ve,R as U,k as be,l as W,S as z,m as _e,A as V,B as J,c as le,j as de,D as ye,M as Ce,I as Se}from"./MetaInfoManager-CqDpbzWQ.js";import{l as E}from"./index.m-DI45-rQC.js";import{u as N,V as Ie,D as we,d as Fe}from"./app-Ck7UBcd6.js";import{f as O,a as Te}from"./Content-CSTk_AN3.js";import{d as Re}from"./dayjs.min-BIwLhz4I.js";import"./Listing-DOaYGk-1.js";import{g as Z}from"./useDataSource-CV-XnRBP.js";import{u as ke,S as A}from"./Section-DFrm5BHt.js";import{d as Be}from"./Edit-B9bTPveV.js";import{B as x}from"./Box-BUYeTdQC.js";import{T as h}from"./Typography-BWGjmqeb.js";import{I as q}from"./List-Dh7P2IJ_.js";import{S as ce}from"./Sorter-RHivQPlc.js";import{B as R}from"./Button-DZLqdWgp.js";import{a as De,_ as G}from"./identifier-CVVhstXo.js";import{g as Ee,a as Ae,c as Pe}from"./extendSxProp-5tSxLnIE.js";import{s as Le,u as Me,c as Ue}from"./useSlotProps-DL7U-EaF.js";import{T as We,a as ee,b as $e}from"./TableRow-DIaWC5aH.js";import{T as ze}from"./TableHead-D8dFZ9CG.js";import{T}from"./TableCell-BHBxOuch.js";import{C as Ne,a as Oe}from"./CollectionsManager-Cht6rkiI.js";import{C as Y}from"./Confirm-BbQLBhxQ.js";import{G as _}from"./Grid-CEw1b08m.js";import{T as j,F as $}from"./TextField-CljZtUFq.js";import{M as te,P as M}from"./PlateFormControl-FIrGEPDZ.js";import{F as re}from"./FormControlLabel-Byp9hQbH.js";import{S as se,A as X}from"./AppBarHeader-ClGrA22v.js";import{M as ue}from"./MenuItem-Cc58SkCm.js";import{I as me}from"./InputFile-D0HUmVGA.js";import{D as pe}from"./DialogTitle-A-veO2Kn.js";import{F as L}from"./FormLabel-BEbkwqxG.js";import{I as K,S as Ve}from"./Select-lP02voS4.js";import{C as Ye}from"./ContentScroll-D9O6pf62.js";import"./_commonjsHelpers-BosuxZz1.js";import"./browser-D9eauH0H.js";import"./index-Ax6NoBCi.js";import"./Menu-BCMxz3f0.js";import"./useFormControl-CO6OogGI.js";import"./ButtonBase-D5ln7if4.js";import"./Grow-1FiP9biG.js";import"./GlobalStyles-D_Xt43Ne.js";import"./index-AoxikDaj.js";import"./RemoveCircle-CnluI2R2.js";import"./Config--wjR88LA.js";import"./axios-CMJq23T0.js";import"./index-BDIa4gQt.js";import"./_baseFlatten-DKoV2aKy.js";import"./Add-oTwsifuF.js";import"./ListItemIcon-BNV_poop.js";import"./ListItemText-BFrp0ozb.js";import"./Tooltip-B-18blil.js";import"./Popper-BKUAU8_E.js";import"./Twitter-l9r6Aqk9.js";import"./DataGridUtils-DqQ54bwL.js";import"./PublishStatusIcon-DtyKOrUb.js";import"./map-Dd2nvkUl.js";import"./index-D3ylJrlI.js";import"./InputAdornment-C_Fu6lZu.js";import"./useMediaQuery-DtNN74dm.js";import"./index-DxE8ywAI.js";import"./utc-BUuWioZ3.js";import"./ThemeProvider-DYHukqtx.js";import"./index-BXImJBSP.js";import"./Close-DeKdm8LF.js";import"./toPropertyKey-PLuKRk1e.js";import"./Autocomplete-CEusBT7t.js";import"./usePreviousProps-eB1Ppz6I.js";import"./Checkbox-CIFK-wKz.js";import"./SwitchBase-CcKqqM_7.js";import"./CircularProgress-DeCS6LzF.js";import"./DragIndicator-B36lBmZE.js";import"./lodash-BYTxXjAY.js";import"./DataCellCollectionTree-AKS66MIS.js";import"./Stack-B2ZIJkbS.js";import"./Autocomplete.renderers-BOt6_7lF.js";import"./AutocompleteSingle-2cxsNThQ.js";function He(t){return Ee("MuiTableContainer",t)}Ae("MuiTableContainer",["root"]);const Je=["className","component"],qe=t=>{const{classes:s}=t;return Ue({root:["root"]},He,s)},Xe=Le("div",{name:"MuiTableContainer",slot:"Root",overridesResolver:(t,s)=>s.root})({width:"100%",overflowX:"auto"}),Ke=u.forwardRef(function(s,r){const a=Me({props:s,name:"MuiTableContainer"}),{className:n,component:m="div"}=a,o=De(a,Je),d=G({},a,{component:m}),l=qe(d);return e.jsx(Xe,G({ref:r,as:m,className:Pe(l.root,n),ownerState:d},o))}),Qe=t=>{D.Inertia.get(E("admin.items.edit",{id:t}).toString(),{})},Ze=({item:t,dragHandle:s,removeHandle:r})=>{var n;const a=t.item.type==="resource";return e.jsxs(x,{sx:{display:"flex",width:"100%",alignItems:"center",borderBottomStyle:"solid",borderBottomWidth:1,borderColor:"divider",paddingBottom:.5,paddingTop:.5,"&:first-child":{borderTopWidth:1,borderTopStyle:"solid"}},children:[s,e.jsx(h,{variant:"body1",sx:{flexBasis:"25%",flexShrink:0,flexGrow:2,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"pre"},children:O(t.item)??t.item.contents[0].title??"-untitled-"}),e.jsx(x,{children:(n=t.item.contents)==null?void 0:n.map(({lang:m})=>m).join(",")}),e.jsx(q,{size:"small",onClick:()=>{Qe(t.item.id)},color:"secondary",children:e.jsx(Be,{sx:{fontSize:"1rem"}})}),a&&e.jsx(x,{sx:{flexBasis:"25%",flexShrink:0,flexGrow:2,overflow:"hidden",marginLeft:1,marginRight:1},children:e.jsx(ge,{item:t.item})}),e.jsx(h,{variant:"caption",sx:{flexBasis:"8%",flexShrink:0},children:t.item.subtype?t.item.subtype:t.item.type}),r]})},Ge=({item:t,dragHandle:s,removeHandle:r,onChange:a})=>{const[n,m]=u.useState(t.label||""),o=()=>{a&&a({...t,label:n})};return e.jsxs(x,{sx:{display:"flex",whiteSpace:"pre",alignItems:"baseline",borderRadius:1,borderStyle:"solid",borderWidth:1,borderColor:"divider",paddingLeft:s?0:1,paddingRight:1,margin:.5},children:[s,e.jsx(x,{sx:{flexBasis:"25%",flexShrink:0,flexGrow:2,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"pre"},children:e.jsx(j,{value:n,placeholder:"Label",onChange:d=>m(d.target.value),fullWidth:!0,margin:"dense",variant:"standard",onBlur:o,size:"small"})}),e.jsx(h,{variant:"body2",sx:{flexBasis:"25%",flexShrink:0,flexGrow:4,overflow:"hidden",marginLeft:1,marginRight:1},children:t.original_filename}),r]})},et=["phone_main","phone_other","phone_other2","fax_main","fax_other","website","email","email_other","street1","street2","street3","zip","city","state","country_code"],tt=({content:t,onChange:s})=>{const[r,a]=u.useState(t!=null&&t.contacts&&(t!=null&&t.contacts[0])?t==null?void 0:t.contacts[0]:void 0);u.useEffect(()=>{a(t==null?void 0:t.contacts[0])},[t.contacts]);const n=(o,d)=>{a(l=>({...l,[o]:d}))},m=()=>{r!==(t==null?void 0:t.contacts[0])&&s("contacts",[r])};return r?e.jsxs(_,{container:!0,spacing:1,children:[e.jsx(_,{item:!0,xs:12,children:e.jsx(h,{variant:"h6",children:"Contact card"})}),et.map((o,d)=>e.jsx(_,{item:!0,xs:4,children:e.jsx(j,{value:r[o]??"",label:je(o),variant:"outlined",fullWidth:!0,onChange:l=>n(o,l.target.value),onBlur:m,margin:"dense",InputLabelProps:{shrink:!0}})},d))]}):e.jsx(h,{children:"No contact details found."})},rt=({content:t,onChange:s})=>{const[r,a]=u.useState(t.dev_coop_project),[n,m]=u.useState(()=>(r==null?void 0:r.partners.filter(({role:i})=>i==="benefitting"))||[]),[o,d]=u.useState(()=>(r==null?void 0:r.partners.filter(({role:i})=>i==="dev_coop"))||[]);u.useEffect(()=>{a(t==null?void 0:t.dev_coop_project)},[t.dev_coop_project]),u.useEffect(()=>{a(i=>{if(!i)return i;const g=[...n,...o].map(v=>{const S={...v};return delete S.country_name,S});return{...i,partners:g}})},[n,o]);const l=({benefitting:i=n,coop:g=o})=>{const v=[...i,...g].map(F=>{const k={...F};return delete k.country_name,k}),S={...r,partners:v};m(i),d(g),s("dev_coop_project",S)},c=u.useCallback((i,g)=>{a(v=>v?v[i]===g?v:{...v,[i]:g}:{[i]:g})},[]),w=i=>{s("dev_coop_project",r&&{...r,is_reviewed:i})},y=i=>{s("dev_coop_project",r&&{...r,regional:!!i})},p=()=>{r!==t.dev_coop_project&&s("dev_coop_project",r)};return r?e.jsx(_,{container:!0,spacing:1,children:e.jsxs(_,{item:!0,xs:12,children:[e.jsx(h,{variant:"h6",children:"Development cooperation project"}),e.jsx(re,{control:e.jsx(se,{checked:!!r.is_reviewed,onChange:(i,g)=>{w(g)}}),label:"Reviewed by EiiE staff"}),e.jsx(re,{control:e.jsx(se,{checked:!!r.regional,onChange:(i,g)=>{y(g)}}),label:"Regional Project"}),e.jsx(h,{variant:"h6",children:"Implementing Organizations"}),e.jsx(te,{role:"benefitting",onChange:i=>l({benefitting:i}),initialPartners:n,adminMode:!0}),e.jsx(h,{variant:"h6",children:"Cooperation Partners"}),e.jsx(te,{role:"dev_coop",onChange:i=>l({coop:i}),initialPartners:o,adminMode:!0}),e.jsx(h,{variant:"h6",children:"Project details (public)"}),e.jsxs(_,{container:!0,spacing:2,children:[e.jsx(_,{item:!0,xs:6,children:e.jsx(j,{value:r.year_start??"",label:"Year started",onChange:i=>c("year_start",parseInt(i.target.value)),onBlur:p,margin:"dense"})}),e.jsx(_,{item:!0,xs:6,children:e.jsx(j,{value:r.year_end??"",label:"Year ended",onChange:i=>c("year_end",parseInt(i.target.value)),onBlur:p,margin:"dense"})})]}),e.jsx(j,{value:r.url??"",label:"URL",onChange:i=>c("url",i.target.value),onBlur:p}),e.jsx(j,{value:r.public_email??"",label:"Published Email Address",onChange:i=>c("public_email",i.target.value),onBlur:p}),e.jsx(M,{label:"Description",onChange:i=>c("description",JSON.stringify(i)),initialValueAsText:r.description,FormControlProps:{margin:"dense",onBlur:p}}),e.jsx(M,{label:"Objectives",onChange:i=>c("objectives",JSON.stringify(i)),initialValueAsText:r.objectives,FormControlProps:{margin:"dense",onBlur:p}}),e.jsx(M,{label:"Activities",onChange:i=>c("activities",JSON.stringify(i)),initialValueAsText:r.activities,FormControlProps:{margin:"dense",onBlur:p}}),e.jsx(M,{label:"Outcomes",onChange:i=>c("outcomes",JSON.stringify(i)),initialValueAsText:r.outcomes,FormControlProps:{margin:"dense",onBlur:p}}),e.jsx(h,{variant:"h6",children:"Additional information (not public)"}),e.jsx(j,{value:r.contact_name??"",label:"Contact Person",onChange:i=>c("contact_name",i.target.value),onBlur:p}),e.jsx(j,{value:r.contact_email??"",label:"Contact Email",onChange:i=>c("contact_email",i.target.value),onBlur:p}),e.jsx(j,{value:r.funding??"",label:"Funding",onChange:i=>c("funding",i.target.value),onBlur:p}),e.jsxs(x,{display:"flex",gap:2,children:[e.jsx(j,{select:!0,hiddenLabel:!0,fullWidth:!0,value:r.budget_currency,onChange:i=>c("budget_currency",i.target.value),sx:{width:60},children:["â‚¬","$"].map(i=>e.jsx(ue,{value:i,children:i},i))}),e.jsx(j,{value:r.budget_amount||"",onChange:i=>c("budget_amount",parseInt(i.target.value)||0),label:"Budget"})]}),e.jsx(j,{value:r.remark_internal??"",label:"Remarks",onChange:i=>c("remark_internal",i.target.value),onBlur:p})]})}):e.jsx(h,{color:"error",children:"No development cooperation project info found, this is an error."})},st=({content:t,onChange:s})=>{const[r,a]=u.useState(t==null?void 0:t.embeds);u.useEffect(()=>{a(t.embeds)},[t.embeds]);const n=(o,d,l)=>{a(c=>[{...c[0],[d]:l},...c.slice(1)])},m=()=>{r!==t.embeds&&s("embeds",r)};return r!=null&&r.length?e.jsxs(e.Fragment,{children:[e.jsx(h,{variant:"h6",children:"Embed social"}),r.map((o,d)=>e.jsx(_,{container:!0,spacing:2,children:e.jsx(_,{item:!0,xs:12,children:e.jsx(j,{value:o.post_url||"",label:"Social Media Post URL",variant:"outlined",fullWidth:!0,onChange:l=>n(0,"post_url",l.target.value),onBlur:m})})},d))]}):e.jsx(h,{color:"error",children:"No post url found, this is an error."})},it=({content:t,onChange:s})=>{const[r,a]=u.useState(""),n=u.useRef(null),[m,o]=u.useState(!1),{needSave:d}=N(),[l,c]=u.useState(!1),{post:w,result:y,errors:p,progress:i,isBusy:g,reset:v}=ne(),S=()=>{var b,I;o(!!((I=(b=n.current)==null?void 0:b.files)!=null&&I.length))},F=()=>{var I,f;if(o(!1),!((f=(I=n.current)==null?void 0:I.files)!=null&&f.length)||!t.id)return;const b=new FormData;b.set("label",r),b.set("content_id",`${t.id}`),b.append("files[]",n.current.files[0]),w(E("admin.resourceitem.file.upload"),b)},k=b=>{s("files",b)};u.useEffect(()=>{y!=null&&y.success&&(D.Inertia.reload(),c(!1))},[y]),u.useEffect(()=>{l&&v()},[l,v]);const B=!t.id||d;return e.jsxs(e.Fragment,{children:[e.jsx(h,{variant:"h6",children:"Files"}),e.jsxs(x,{display:"flex",flexDirection:"row",justifyContent:"flex-start",alignItems:"center",marginBottom:2,children:[e.jsx(R,{disabled:B,onClick:()=>c(!0),variant:"outlined",children:"Add file"}),B&&e.jsx(h,{variant:"body2",color:"textSecondary",marginLeft:2,children:"First save before adding files"})]}),t.files.filter(({label:b})=>!b).length>1&&e.jsx(h,{variant:"body2",color:"warning",children:"Note: there are multiple files without a label, this might be confusing for visitors of the website. Please provide labels for each file."}),t.files.length>0&&e.jsx(ce,{items:t.files,onChange:k,Renderer:Ge}),l&&e.jsxs(pe,{open:!0,maxWidth:"md",onClose:()=>!g&&c(!1),children:[e.jsx(X,{title:`Add file for ${t.lang.toUpperCase()}`,isDialog:!0,children:e.jsx(q,{edge:"end",color:"inherit",disabled:g,onClick:()=>c(!1),"aria-label":"close",size:"large",children:e.jsx(ae,{})})}),e.jsxs(x,{display:"flex",flexDirection:"column",justifyContent:"space-between",padding:2,children:[e.jsx(j,{fullWidth:!0,variant:"outlined",label:"Label",value:r,onChange:b=>a(b.target.value),error:!!(p!=null&&p.label),InputLabelProps:{shrink:!0},helperText:(p==null?void 0:p.label)||"optional, but needed when there are multiple files"}),e.jsxs(L,{variant:"outlined",fullWidth:!0,error:!!(p!=null&&p.files),children:[e.jsx(K,{shrink:!0,children:"File"}),e.jsx(me,{label:"File",ref:n,onChange:S}),e.jsx($,{children:(p==null?void 0:p.files)||" "})]}),e.jsxs(L,{fullWidth:!0,children:[e.jsx(R,{disabled:!m||d,onClick:F,startIcon:e.jsx(H,{}),color:"primary",variant:"contained",children:"Upload"}),e.jsx($,{children:d?"Save the item before adding uploads":" "})]}),e.jsx(x,{margin:-2,marginTop:2,children:e.jsx(oe,{variant:"determinate",value:i?i*100:0})})]})]})]})},nt=({itemSubtype:t,content:s,onChange:r})=>{const a=ke(),n=u.useRef(null),[m,o]=u.useState(!1),[d,l]=u.useState(),{post:c,result:w,errors:y,reset:p,isBusy:i,progress:g}=ne(),[v,S]=u.useState(!1),{needSave:F}=N();u.useEffect(()=>{w!=null&&w.success&&(D.Inertia.reload(),S(!1))},[w]);const k=f=>{const C=Te(f,a)||f.contents[0];C!=null&&C.images.length?r("images",[{path:C.images[0].path}]):console.log("no image in picked item, shouldnt happen",a,C,f)},B=()=>{var f,C,P,Q;(C=(f=n.current)==null?void 0:f.files)!=null&&C.length&&n.current.files[0].size>10*1024*1024?l(Math.round(n.current.files[0].size/(1024*1024)*10)/10):l(void 0),o(!!((Q=(P=n.current)==null?void 0:P.files)!=null&&Q.length))},b=()=>{var C,P;if(!((P=(C=n.current)==null?void 0:C.files)!=null&&P.length)||!s.id)return;o(!1);const f=new FormData;f.set("content_id",`${s.id}`),f.append("file",n.current.files[0]),c(E("admin.resourceitem.image.replace"),f)};u.useEffect(()=>{v&&p()},[v,p]);const I=!s.id||F;return e.jsxs(e.Fragment,{children:[e.jsx(h,{variant:"body2",children:"The Subtitle field will be used as caption, if present."}),e.jsx(h,{variant:"h6",children:"Image"}),e.jsxs(x,{display:"flex",flexDirection:"row",children:[e.jsx(ve,{imageResource:s.images[0],imageType:t,imageOnly:!0,sx:{width:"100%",maxWidth:350,mr:2,mb:1}}),e.jsx(x,{display:"flex",flexDirection:"column",alignItems:"flex-start",children:s.id?e.jsxs(e.Fragment,{children:[e.jsx(h,{variant:"body2",marginBottom:1,children:"Replace image for this language, either by picking an existing image or uploading a new file."}),e.jsx(U,{label:"Find existing image",onPick:k,menu:[be],buttonProps:{color:"primary",variant:"outlined",size:"medium"}}),e.jsxs(x,{display:"flex",flexDirection:"column",justifyContent:"flex-start",alignItems:"start",marginTop:1,padding:0,children:[e.jsx(R,{disabled:I,onClick:()=>S(!0),variant:"outlined",startIcon:e.jsx(H,{}),children:"Upload a new file"}),I&&e.jsx(h,{variant:"body2",color:"textSecondary",children:"First save before uploading a new image file"})]})]}):e.jsx(h,{variant:"body1",children:"Save item first in order to replace the image."})})]}),v&&e.jsxs(pe,{open:!0,maxWidth:"md",onClose:()=>!i&&S(!1),children:[e.jsx(X,{title:`Upload new image for ${s.lang.toUpperCase()}`,isDialog:!0,children:e.jsx(q,{edge:"end",color:"inherit",disabled:i,onClick:()=>S(!1),"aria-label":"close",size:"large",children:e.jsx(ae,{})})}),e.jsxs(x,{display:"flex",flexDirection:"column",justifyContent:"space-between",padding:2,children:[e.jsxs(L,{variant:"outlined",fullWidth:!0,error:!!(y!=null&&y.files),children:[e.jsx(K,{shrink:!0,children:"File"}),e.jsx(me,{label:"File",ref:n,accept:"image/*",onChange:B}),e.jsx($,{children:(y==null?void 0:y.files)||(d?`Large file: ${d}MB`:" ")})]}),e.jsxs(L,{fullWidth:!0,children:[e.jsx(R,{disabled:!m||F,onClick:b,startIcon:e.jsx(H,{}),color:d?"warning":"primary",variant:"contained",children:"Upload"}),e.jsx($,{children:F?"Save the item before adding uploads":" "})]}),e.jsx(x,{margin:-2,marginTop:2,children:e.jsx(oe,{variant:"determinate",value:g?g*100:0})})]})]})]})},at=({content:t,onChange:s})=>{const[r,a]=u.useState(t==null?void 0:t.links);u.useEffect(()=>{a(t.links)},[t.links]);const n=(o,d,l)=>{a(c=>[{...c[0],[d]:l},...c.slice(1)])},m=()=>{r!==t.links&&s("links",r)};return r!=null&&r.length?e.jsxs(e.Fragment,{children:[e.jsx(h,{variant:"h6",children:"Link resource"}),r.map((o,d)=>e.jsxs(_,{container:!0,spacing:2,children:[e.jsx(_,{item:!0,xs:4,children:e.jsx(j,{value:o.label||"",label:"Label",variant:"outlined",fullWidth:!0,onChange:l=>n(0,"label",l.target.value),onBlur:m})}),e.jsx(_,{item:!0,xs:8,children:e.jsx(j,{value:o.url||"",label:"URL",variant:"outlined",fullWidth:!0,onChange:l=>n(0,"url",l.target.value),onBlur:m})})]},d))]}):e.jsx(h,{color:"error",children:"No link found, this is an error."})},ot=({content:t,onChange:s})=>{const[r,a]=u.useState(t==null?void 0:t.videos);u.useEffect(()=>{a(t.videos)},[t.videos]);const n=(o,d,l)=>{a(c=>[{...c[0],[d]:l},...c.slice(1)])},m=()=>{r!==t.videos&&s("videos",r)};return r!=null&&r.length?e.jsxs(e.Fragment,{children:[e.jsx(h,{variant:"h6",children:"Video resource"}),r.map((o,d)=>e.jsxs(_,{container:!0,spacing:2,children:[e.jsx(_,{item:!0,xs:6,children:e.jsxs(L,{variant:"outlined",fullWidth:!0,children:[e.jsx(K,{children:"Provider"}),e.jsx(Ve,{value:o.provider,onChange:l=>n(0,"provider",l.target.value),label:"Provider",fullWidth:!0,children:Ie.map((l,c)=>e.jsx(ue,{value:l,children:l},c))})]})}),e.jsx(_,{item:!0,xs:6,children:e.jsx(j,{value:o.provider_id||"",label:"ID",variant:"outlined",fullWidth:!0,onChange:l=>n(0,"provider_id",l.target.value),onBlur:m})})]},d))]}):e.jsx(h,{color:"error",children:"No video details found, this is an error."})},lt=t=>{switch(t.type){case"dev_coop_project":return rt;case"contact":case"person":return t.contents.length&&t.contents[0].contacts?tt:void 0}switch(t.subtype){case"link":return at;case"image":case"image.icon":case"image.portrait":case"image.square":return nt;case"file":return it;case"video":return ot;case"embed":return st;default:return}},dt=({item:t})=>{const s=t.collections||[],r=[];return t.type==="resource"&&W(t)&&r.push({title:"Image resource",text:e.jsxs(e.Fragment,{children:["Image for ",e.jsx("strong",{children:t.image_for_items_count??0})," ","items",e.jsx("br",{}),"and for"," ",e.jsx("strong",{children:t.image_for_collections_count??0})," ","collections"]})}),r.push({title:"Level of contextualization",text:e.jsxs(e.Fragment,{children:["This item is part of ",e.jsx("strong",{children:s.length})," ",s.length===1?"collection":"collections","."]})}),r.push({title:"Collection ordering",text:e.jsx(e.Fragment,{children:s.length?s.slice(0,3).map(a=>O(a)).join(", ")+", ...":e.jsx(e.Fragment,{children:"- no collections -"})})}),e.jsx(z,{contents:r})},ct=t=>t!=null&&t.length?"Item has attachments":"No attachments",ut=t=>t!=null&&t.length?t.reduce((s,{attachments:r})=>s+r.length,0):0,mt=t=>{const s=ut(t);if(s)return t.length===1?s==1?`${s} attachment.`:`${s} attachments.`:`A total of ${s} attachments in ${t.length} groups.`},pt=({attachmentGroups:t})=>{const s=_e(),r=(o,d,l)=>{s({type:"attachmentgroup_update",index:o,field:d,value:l})},a=o=>{s({type:"attachmentgroup_remove",index:o})},n=()=>{s({type:"attachmentgroup_add"})},m=(o,d)=>{s({type:"attachment_add",groupIndex:o,attachedItem:d})};return e.jsxs(A,{title:"Attachments",summary:e.jsx(z,{contents:[{title:ct(t),text:mt(t)},{title:"Add attachment",text:(t==null?void 0:t.length)>1?"Open the panel to add an attachment to a group.":void 0,component:(t==null?void 0:t.length)>1?void 0:e.jsx(U,{label:"Attachment",menu:V,onPick:o=>{m(void 0,o)}})}]}),children:[e.jsx(h,{variant:"body1",children:"Attachments are grouped, where each group can optionally have a title and a blurb."}),t.map((o,d)=>e.jsxs(x,{display:"flex",flexDirection:"column",children:[e.jsxs(x,{display:"flex",flexDirection:"row",children:[e.jsx(x,{flexGrow:2,children:e.jsx(h,{variant:"h6",children:O(o)||"-untitled-"})}),e.jsx(J,{color:"secondary",onConfirm:()=>a(d),icon:e.jsx(ie,{}),buttonProps:{size:"small"},children:"Removing attachment group can not be undone."})]}),e.jsx(le,{contents:o.contents,fields:["title","blurb"],onChange:l=>r(d,"contents",l)}),e.jsx(ce,{items:o.attachments,Renderer:Ze,onChange:l=>r(d,"attachments",l),getId:l=>l.item.id}),e.jsx(x,{children:e.jsx(U,{label:"Attachment",menu:V,onPick:l=>{m(d,l)}})}),e.jsx(we,{variant:"middle"})]},d)),(t==null?void 0:t.length)===0?e.jsx(U,{label:"Attachment",menu:V,onPick:o=>{m(void 0,o)}}):e.jsx(R,{onClick:n,startIcon:e.jsx(Fe,{}),color:"secondary",size:"small",children:"Attachment Group"})]})},ht=t=>[...t.main,...t.contents.flatMap(({lang:s,audits:r})=>r.map(a=>({...a,lang:s})))].sort((s,r)=>s.created_at>r.created_at?-1:1),ft=()=>{const{audits:t}=he().props,s=t?ht(t):[];return e.jsx(A,{title:"Audit",summary:e.jsx(z,{contents:[{title:"Recent audits",text:`${s.length||0} changes recorded`}]}),children:e.jsx(Ke,{children:e.jsxs(We,{size:"small",children:[e.jsx(ze,{children:e.jsxs(ee,{children:[e.jsx(T,{children:"Timestamp"}),e.jsx(T,{children:"User"}),e.jsx(T,{children:"Event"}),e.jsx(T,{children:"Lang"}),e.jsx(T,{children:"Fields"})]})}),e.jsx($e,{children:s.map(r=>{var a;return e.jsxs(ee,{children:[e.jsx(T,{style:{whiteSpace:"pre"},children:Re(r.created_at).format("YYYY-MM-DD HH:mm")}),e.jsx(T,{style:{whiteSpace:"pre"},children:((a=r.user)==null?void 0:a.name)??""}),e.jsx(T,{children:r.event}),e.jsx(T,{children:r.lang||""}),e.jsx(T,{children:Object.keys(r.new_values).join(", ")})]},r.id)})})]})})})},xt=({item:t})=>{const{needSave:s}=N();return e.jsxs(x,{children:["This image resource is used for"," ",t.image_for_items_count?e.jsx(J,{label:`${t.image_for_items_count} items`,color:"primary",needConfirmation:s,onConfirm:()=>{Z("admin.items.index",{filter:{"imageitem.id":t.id}})},variant:"outlined"}):e.jsx(e.Fragment,{children:"0 items"})," ","and for"," ",t.image_for_collections_count?e.jsx(J,{label:`${t.image_for_collections_count} collections`,color:"primary",needConfirmation:s,onConfirm:()=>{Z("admin.collections.index",{filter:{"imageitem.id":t.id}})},variant:"outlined"}):e.jsx(e.Fragment,{children:"0 collections"})]})},gt=(t,s)=>{var a;let r;if(s.type==="patch")r={...t,[s.field]:s.value};else if(s.type==="item_reset")r=s.item;else if(s.type==="attachmentgroup_update")r={...t,attachment_groups:t.attachment_groups.map((n,m)=>m===s.index?{...n,[s.field]:s.value}:n)};else if(s.type==="attachmentgroup_add")r={...t,attachment_groups:[...t.attachment_groups,{id:0,order:t.attachment_groups.length,contents:[],attachments:[]}]};else if(s.type==="attachmentgroup_remove"){const n=[...t.attachment_groups];n.splice(s.index,1),r={...t,attachment_groups:n}}else if(s.type==="attachment_add")if(s.groupIndex===void 0&&!((a=t.attachment_groups)!=null&&a.length))r={...t,attachment_groups:[{id:0,order:0,contents:[],attachments:[{id:0,order:0,item:s.attachedItem}]}]};else{(!s.groupIndex||s.groupIndex>=t.attachment_groups.length)&&(s.groupIndex=0);const n={...t.attachment_groups[s.groupIndex]};n.attachments=[...n.attachments,{id:0,order:n.attachments.length||0,item:s.attachedItem}];const m=[...t.attachment_groups];m[s.groupIndex]=n,r={...t,attachment_groups:m}}else console.warn("invalid reducer action",s),r=t;return de.diff(r,t)?r:t},Vr=({item:t,can:s})=>{var v,S,F,k,B,b,I;const[r,a]=u.useReducer(gt,t),[n,m]=u.useState(),{needSave:o,setNeedSave:d}=N(),l=()=>{D.Inertia.patch(E("admin.items.update",{item:r}).toString(),n,{preserveState:!1,replace:!0,onFinish:()=>{r.type==="dev_coop_project"&&window.location.reload()}}),d(!1)},c=()=>{a({type:"item_reset",item:t})},w=u.useCallback(f=>{a({type:"patch",field:"contents",value:f})},[]),y=!!r.deleted_at,p=()=>{D.Inertia.post(E("admin.items.trash",{id:r.id}))},i=()=>{D.Inertia.post(E("admin.items.restore",{id:r.id}))},g=()=>{D.Inertia.delete(E("admin.items.destroy",{id:r.id}))};return u.useEffect(()=>{d(!!n)},[n,d]),u.useEffect(()=>{a({type:"item_reset",item:t})},[t]),u.useEffect(()=>{m(de.diff(t,r))},[t,r]),e.jsxs(ye,{dispatch:a,children:[e.jsxs(X,{title:"Edit Item",children:[e.jsx(R,{variant:"outlined",onClick:c,color:"secondary",disabled:!o,children:"Reset"}),e.jsx(R,{variant:o?"contained":"outlined",onClick:l,color:"secondary",disabled:!o,children:"Save"})]}),e.jsx(Ye,{children:e.jsxs("form",{autoComplete:"off",autoCapitalize:"off",children:[e.jsx(x,{padding:2,children:e.jsx(h,{variant:"h4",children:O(r)||((v=r.contents.at(0))==null?void 0:v.title)||"-no title-"})}),e.jsx(Ce,{item:r}),r.type==="activityreport_congress"&&e.jsx(A,{title:"Report to World Congress",open:!0,children:e.jsxs(x,{display:"flex",gap:2,children:[e.jsx(j,{label:"Year from",value:((S=r.activity_report_congress)==null?void 0:S.year_from)||"",onChange:f=>{const C=parseInt(f.currentTarget.value)||0;a({type:"patch",field:"activity_report_congress",value:{...r.activity_report_congress,year_from:C}})}}),e.jsx(j,{label:"Year to",value:((F=r.activity_report_congress)==null?void 0:F.year_to)||"",onChange:f=>{const C=parseInt(f.currentTarget.value)||0;a({type:"patch",field:"activity_report_congress",value:{...r.activity_report_congress,year_to:C}})}})]})}),e.jsx(A,{title:"Contents",open:!0,summary:e.jsx(z,{contents:[{title:"Languages",text:((k=r.contents)==null?void 0:k.map(({lang:f})=>f).join(", "))||"No content"}]}),children:e.jsx(le,{contents:r.contents,fields:r.type==="contact"?["title","subtitle","blurb"]:r.type==="dev_coop_project"?["title"]:["title","subtitle","blurb","content"],htmlFields:{content:"full",blurb:"limited"},itemSubtype:r.subtype,additionalEditor:lt(r),onChange:w})}),e.jsxs(A,{title:"Context",summary:e.jsx(dt,{item:r}),children:[W(r)&&e.jsx(xt,{item:r}),e.jsx(Ne,{collections:r.collections??[],groupings:Oe,onChange:f=>a({type:"patch",field:"collections",value:f})})]}),!W(r)&&e.jsx(Se,{images:r.all_images,support_color:r.support_color}),!W(r)&&r.subtype!=="file"&&e.jsx(pt,{attachmentGroups:r.attachment_groups}),e.jsx(ft,{}),e.jsx(A,{title:"Actions",children:e.jsx(x,{display:"flex",gap:2,children:y?e.jsxs(e.Fragment,{children:[((B=s==null?void 0:s.items)==null?void 0:B.restoreMany)&&e.jsx(Y,{onConfirm:i,children:e.jsx(R,{variant:"contained",startIcon:e.jsx(fe,{}),children:"Restore from Trash"})}),((b=s==null?void 0:s.items)==null?void 0:b.forceDeleteMany)&&e.jsx(Y,{onConfirm:g,children:e.jsx(R,{variant:"contained",color:"error",startIcon:e.jsx(xe,{}),children:"Delete permanently"})})]}):e.jsx(e.Fragment,{children:((I=s==null?void 0:s.items)==null?void 0:I.deleteMany)&&e.jsx(Y,{onConfirm:p,children:e.jsx(R,{variant:"contained",color:"primary",startIcon:e.jsx(ie,{}),children:"Move to Trash"})})})})}),!1]})})]})};export{Vr as default};
