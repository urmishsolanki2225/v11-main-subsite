import{j as s,r as B}from"./client-ZKQMN23D.js";import{d as oe}from"./index-BmtA0KFl.js";import{d as le}from"./Edit-B9bTPveV.js";import{i as ae}from"./identifier-CVVhstXo.js";import{r as fe,T as G}from"./Typography-BWGjmqeb.js";import{b as d}from"./index-BDIa4gQt.js";import{l as ue}from"./index.m-DI45-rQC.js";import{I as ce}from"./InputFile-D0HUmVGA.js";import{S as Q}from"./Section-DFrm5BHt.js";import"./app-Ck7UBcd6.js";import{A as de,S as _e}from"./AppBarHeader-ClGrA22v.js";import{C as me}from"./ContentScroll-D9O6pf62.js";import{P as he,I as ge}from"./List-Dh7P2IJ_.js";import{T as q}from"./TextField-CljZtUFq.js";import{T as X,a as U,b as K}from"./TableRow-DIaWC5aH.js";import{T as ee}from"./TableHead-D8dFZ9CG.js";import{T as E}from"./TableCell-BHBxOuch.js";import{S as pe}from"./Select-lP02voS4.js";import{M as H}from"./MenuItem-Cc58SkCm.js";import{B as be}from"./Button-DZLqdWgp.js";import"./_commonjsHelpers-BosuxZz1.js";import"./browser-D9eauH0H.js";import"./index-Ax6NoBCi.js";import"./ButtonBase-D5ln7if4.js";import"./useSlotProps-DL7U-EaF.js";import"./extendSxProp-5tSxLnIE.js";import"./Grow-1FiP9biG.js";import"./Box-BUYeTdQC.js";import"./index-DxE8ywAI.js";import"./dayjs.min-BIwLhz4I.js";import"./utc-BUuWioZ3.js";import"./ThemeProvider-DYHukqtx.js";import"./index-AoxikDaj.js";import"./index-BXImJBSP.js";import"./Close-DeKdm8LF.js";import"./ListItemIcon-BNV_poop.js";import"./ListItemText-BFrp0ozb.js";import"./Tooltip-B-18blil.js";import"./Popper-BKUAU8_E.js";import"./GlobalStyles-D_Xt43Ne.js";import"./Menu-BCMxz3f0.js";import"./useFormControl-CO6OogGI.js";import"./InputAdornment-C_Fu6lZu.js";import"./usePreviousProps-eB1Ppz6I.js";import"./SwitchBase-CcKqqM_7.js";import"./FormLabel-BEbkwqxG.js";var Y={},ye=ae;Object.defineProperty(Y,"__esModule",{value:!0});var W=Y.default=void 0,we=ye(fe()),Ie=s;W=Y.default=(0,we.default)((0,Ie.jsx)("path",{d:"M1 21h22L12 2zm12-3h-2v-2h2zm0-4h-2v-4h2z"}),"Warning");class y extends Error{constructor(e,_,t,...n){Array.isArray(_)&&(_=_.join(" ").trim()),super(_),Error.captureStackTrace!==void 0&&Error.captureStackTrace(this,y),this.code=e;for(const l of n)for(const a in l){const i=l[a];this[a]=d.Buffer.isBuffer(i)?i.toString(t.encoding):i==null?i:JSON.parse(JSON.stringify(i))}}}const Se=function(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)},se=function(r){const e=[];for(let _=0,t=r.length;_<t;_++){const n=r[_];if(n==null||n===!1)e[_]={disabled:!0};else if(typeof n=="string")e[_]={name:n};else if(Se(n)){if(typeof n.name!="string")throw new y("CSV_OPTION_COLUMNS_MISSING_NAME",["Option columns missing name:",`property "name" is required at position ${_}`,"when column is an object literal"]);e[_]=n}else throw new y("CSV_INVALID_COLUMN_DEFINITION",["Invalid column definition:","expect a string or a literal object,",`got ${JSON.stringify(n)} at position ${_}`])}return e};class te{constructor(e=100){this.size=e,this.length=0,this.buf=d.Buffer.allocUnsafe(e)}prepend(e){if(d.Buffer.isBuffer(e)){const _=this.length+e.length;if(_>=this.size&&(this.resize(),_>=this.size))throw Error("INVALID_BUFFER_STATE");const t=this.buf;this.buf=d.Buffer.allocUnsafe(this.size),e.copy(this.buf,0),t.copy(this.buf,e.length),this.length+=e.length}else{const _=this.length++;_===this.size&&this.resize();const t=this.clone();this.buf[0]=e,t.copy(this.buf,1,0,_)}}append(e){const _=this.length++;_===this.size&&this.resize(),this.buf[_]=e}clone(){return d.Buffer.from(this.buf.slice(0,this.length))}resize(){const e=this.length;this.size=this.size*2;const _=d.Buffer.allocUnsafe(this.size);this.buf.copy(_,0,0,e),this.buf=_}toString(e){return e?this.buf.slice(0,this.length).toString(e):Uint8Array.prototype.slice.call(this.buf.slice(0,this.length))}toJSON(){return this.toString("utf8")}reset(){this.length=0}}const Oe=12,xe=13,Ne=10,ve=32,Ce=9,Ee=function(r){return{bomSkipped:!1,bufBytesStart:0,castField:r.cast_function,commenting:!1,error:void 0,enabled:r.from_line===1,escaping:!1,escapeIsQuote:d.Buffer.isBuffer(r.escape)&&d.Buffer.isBuffer(r.quote)&&d.Buffer.compare(r.escape,r.quote)===0,expectedRecordLength:Array.isArray(r.columns)?r.columns.length:void 0,field:new te(20),firstLineToHeaders:r.cast_first_line_to_header,needMoreDataSize:Math.max(r.comment!==null?r.comment.length:0,...r.delimiter.map(e=>e.length),r.quote!==null?r.quote.length:0),previousBuf:void 0,quoting:!1,stop:!1,rawBuffer:new te(100),record:[],recordHasError:!1,record_length:0,recordDelimiterMaxLength:r.record_delimiter.length===0?0:Math.max(...r.record_delimiter.map(e=>e.length)),trimChars:[d.Buffer.from(" ",r.encoding)[0],d.Buffer.from("	",r.encoding)[0]],wasQuoting:!1,wasRowDelimiter:!1,timchars:[d.Buffer.from(d.Buffer.from([xe],"utf8").toString(),r.encoding),d.Buffer.from(d.Buffer.from([Ne],"utf8").toString(),r.encoding),d.Buffer.from(d.Buffer.from([Oe],"utf8").toString(),r.encoding),d.Buffer.from(d.Buffer.from([ve],"utf8").toString(),r.encoding),d.Buffer.from(d.Buffer.from([Ce],"utf8").toString(),r.encoding)]}},je=function(r){return r.replace(/([A-Z])/g,function(e,_){return"_"+_.toLowerCase()})},ne=function(r){const e={};for(const t in r)e[je(t)]=r[t];if(e.encoding===void 0||e.encoding===!0)e.encoding="utf8";else if(e.encoding===null||e.encoding===!1)e.encoding=null;else if(typeof e.encoding!="string"&&e.encoding!==null)throw new y("CSV_INVALID_OPTION_ENCODING",["Invalid option encoding:","encoding must be a string or null to return a buffer,",`got ${JSON.stringify(e.encoding)}`],e);if(e.bom===void 0||e.bom===null||e.bom===!1)e.bom=!1;else if(e.bom!==!0)throw new y("CSV_INVALID_OPTION_BOM",["Invalid option bom:","bom must be true,",`got ${JSON.stringify(e.bom)}`],e);if(e.cast_function=null,e.cast===void 0||e.cast===null||e.cast===!1||e.cast==="")e.cast=void 0;else if(typeof e.cast=="function")e.cast_function=e.cast,e.cast=!0;else if(e.cast!==!0)throw new y("CSV_INVALID_OPTION_CAST",["Invalid option cast:","cast must be true or a function,",`got ${JSON.stringify(e.cast)}`],e);if(e.cast_date===void 0||e.cast_date===null||e.cast_date===!1||e.cast_date==="")e.cast_date=!1;else if(e.cast_date===!0)e.cast_date=function(t){const n=Date.parse(t);return isNaN(n)?t:new Date(n)};else if(typeof e.cast_date!="function")throw new y("CSV_INVALID_OPTION_CAST_DATE",["Invalid option cast_date:","cast_date must be true or a function,",`got ${JSON.stringify(e.cast_date)}`],e);if(e.cast_first_line_to_header=null,e.columns===!0)e.cast_first_line_to_header=void 0;else if(typeof e.columns=="function")e.cast_first_line_to_header=e.columns,e.columns=!0;else if(Array.isArray(e.columns))e.columns=se(e.columns);else if(e.columns===void 0||e.columns===null||e.columns===!1)e.columns=!1;else throw new y("CSV_INVALID_OPTION_COLUMNS",["Invalid option columns:","expect an array, a function or true,",`got ${JSON.stringify(e.columns)}`],e);if(e.group_columns_by_name===void 0||e.group_columns_by_name===null||e.group_columns_by_name===!1)e.group_columns_by_name=!1;else{if(e.group_columns_by_name!==!0)throw new y("CSV_INVALID_OPTION_GROUP_COLUMNS_BY_NAME",["Invalid option group_columns_by_name:","expect an boolean,",`got ${JSON.stringify(e.group_columns_by_name)}`],e);if(e.columns===!1)throw new y("CSV_INVALID_OPTION_GROUP_COLUMNS_BY_NAME",["Invalid option group_columns_by_name:","the `columns` mode must be activated."],e)}if(e.comment===void 0||e.comment===null||e.comment===!1||e.comment==="")e.comment=null;else if(typeof e.comment=="string"&&(e.comment=d.Buffer.from(e.comment,e.encoding)),!d.Buffer.isBuffer(e.comment))throw new y("CSV_INVALID_OPTION_COMMENT",["Invalid option comment:","comment must be a buffer or a string,",`got ${JSON.stringify(e.comment)}`],e);if(e.comment_no_infix===void 0||e.comment_no_infix===null||e.comment_no_infix===!1)e.comment_no_infix=!1;else if(e.comment_no_infix!==!0)throw new y("CSV_INVALID_OPTION_COMMENT",["Invalid option comment_no_infix:","value must be a boolean,",`got ${JSON.stringify(e.comment_no_infix)}`],e);const _=JSON.stringify(e.delimiter);if(Array.isArray(e.delimiter)||(e.delimiter=[e.delimiter]),e.delimiter.length===0)throw new y("CSV_INVALID_OPTION_DELIMITER",["Invalid option delimiter:","delimiter must be a non empty string or buffer or array of string|buffer,",`got ${_}`],e);if(e.delimiter=e.delimiter.map(function(t){if(t==null||t===!1)return d.Buffer.from(",",e.encoding);if(typeof t=="string"&&(t=d.Buffer.from(t,e.encoding)),!d.Buffer.isBuffer(t)||t.length===0)throw new y("CSV_INVALID_OPTION_DELIMITER",["Invalid option delimiter:","delimiter must be a non empty string or buffer or array of string|buffer,",`got ${_}`],e);return t}),e.escape===void 0||e.escape===!0?e.escape=d.Buffer.from('"',e.encoding):typeof e.escape=="string"?e.escape=d.Buffer.from(e.escape,e.encoding):(e.escape===null||e.escape===!1)&&(e.escape=null),e.escape!==null&&!d.Buffer.isBuffer(e.escape))throw new Error(`Invalid Option: escape must be a buffer, a string or a boolean, got ${JSON.stringify(e.escape)}`);if(e.from===void 0||e.from===null)e.from=1;else if(typeof e.from=="string"&&/\d+/.test(e.from)&&(e.from=parseInt(e.from)),Number.isInteger(e.from)){if(e.from<0)throw new Error(`Invalid Option: from must be a positive integer, got ${JSON.stringify(r.from)}`)}else throw new Error(`Invalid Option: from must be an integer, got ${JSON.stringify(e.from)}`);if(e.from_line===void 0||e.from_line===null)e.from_line=1;else if(typeof e.from_line=="string"&&/\d+/.test(e.from_line)&&(e.from_line=parseInt(e.from_line)),Number.isInteger(e.from_line)){if(e.from_line<=0)throw new Error(`Invalid Option: from_line must be a positive integer greater than 0, got ${JSON.stringify(r.from_line)}`)}else throw new Error(`Invalid Option: from_line must be an integer, got ${JSON.stringify(r.from_line)}`);if(e.ignore_last_delimiters===void 0||e.ignore_last_delimiters===null)e.ignore_last_delimiters=!1;else if(typeof e.ignore_last_delimiters=="number")e.ignore_last_delimiters=Math.floor(e.ignore_last_delimiters),e.ignore_last_delimiters===0&&(e.ignore_last_delimiters=!1);else if(typeof e.ignore_last_delimiters!="boolean")throw new y("CSV_INVALID_OPTION_IGNORE_LAST_DELIMITERS",["Invalid option `ignore_last_delimiters`:","the value must be a boolean value or an integer,",`got ${JSON.stringify(e.ignore_last_delimiters)}`],e);if(e.ignore_last_delimiters===!0&&e.columns===!1)throw new y("CSV_IGNORE_LAST_DELIMITERS_REQUIRES_COLUMNS",["The option `ignore_last_delimiters`","requires the activation of the `columns` option"],e);if(e.info===void 0||e.info===null||e.info===!1)e.info=!1;else if(e.info!==!0)throw new Error(`Invalid Option: info must be true, got ${JSON.stringify(e.info)}`);if(e.max_record_size===void 0||e.max_record_size===null||e.max_record_size===!1)e.max_record_size=0;else if(!(Number.isInteger(e.max_record_size)&&e.max_record_size>=0))if(typeof e.max_record_size=="string"&&/\d+/.test(e.max_record_size))e.max_record_size=parseInt(e.max_record_size);else throw new Error(`Invalid Option: max_record_size must be a positive integer, got ${JSON.stringify(e.max_record_size)}`);if(e.objname===void 0||e.objname===null||e.objname===!1)e.objname=void 0;else if(d.Buffer.isBuffer(e.objname)){if(e.objname.length===0)throw new Error("Invalid Option: objname must be a non empty buffer");e.encoding===null||(e.objname=e.objname.toString(e.encoding))}else if(typeof e.objname=="string"){if(e.objname.length===0)throw new Error("Invalid Option: objname must be a non empty string")}else if(typeof e.objname!="number")throw new Error(`Invalid Option: objname must be a string or a buffer, got ${e.objname}`);if(e.objname!==void 0){if(typeof e.objname=="number"){if(e.columns!==!1)throw Error("Invalid Option: objname index cannot be combined with columns or be defined as a field")}else if(e.columns===!1)throw Error("Invalid Option: objname field must be combined with columns or be defined as an index")}if(e.on_record===void 0||e.on_record===null)e.on_record=void 0;else if(typeof e.on_record!="function")throw new y("CSV_INVALID_OPTION_ON_RECORD",["Invalid option `on_record`:","expect a function,",`got ${JSON.stringify(e.on_record)}`],e);if(e.on_skip!==void 0&&e.on_skip!==null&&typeof e.on_skip!="function")throw new Error(`Invalid Option: on_skip must be a function, got ${JSON.stringify(e.on_skip)}`);if(e.quote===null||e.quote===!1||e.quote==="")e.quote=null;else if(e.quote===void 0||e.quote===!0?e.quote=d.Buffer.from('"',e.encoding):typeof e.quote=="string"&&(e.quote=d.Buffer.from(e.quote,e.encoding)),!d.Buffer.isBuffer(e.quote))throw new Error(`Invalid Option: quote must be a buffer or a string, got ${JSON.stringify(e.quote)}`);if(e.raw===void 0||e.raw===null||e.raw===!1)e.raw=!1;else if(e.raw!==!0)throw new Error(`Invalid Option: raw must be true, got ${JSON.stringify(e.raw)}`);if(e.record_delimiter===void 0)e.record_delimiter=[];else if(typeof e.record_delimiter=="string"||d.Buffer.isBuffer(e.record_delimiter)){if(e.record_delimiter.length===0)throw new y("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a non empty string or buffer,",`got ${JSON.stringify(e.record_delimiter)}`],e);e.record_delimiter=[e.record_delimiter]}else if(!Array.isArray(e.record_delimiter))throw new y("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a string, a buffer or array of string|buffer,",`got ${JSON.stringify(e.record_delimiter)}`],e);if(e.record_delimiter=e.record_delimiter.map(function(t,n){if(typeof t!="string"&&!d.Buffer.isBuffer(t))throw new y("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a string, a buffer or array of string|buffer",`at index ${n},`,`got ${JSON.stringify(t)}`],e);if(t.length===0)throw new y("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a non empty string or buffer",`at index ${n},`,`got ${JSON.stringify(t)}`],e);return typeof t=="string"&&(t=d.Buffer.from(t,e.encoding)),t}),typeof e.relax_column_count!="boolean")if(e.relax_column_count===void 0||e.relax_column_count===null)e.relax_column_count=!1;else throw new Error(`Invalid Option: relax_column_count must be a boolean, got ${JSON.stringify(e.relax_column_count)}`);if(typeof e.relax_column_count_less!="boolean")if(e.relax_column_count_less===void 0||e.relax_column_count_less===null)e.relax_column_count_less=!1;else throw new Error(`Invalid Option: relax_column_count_less must be a boolean, got ${JSON.stringify(e.relax_column_count_less)}`);if(typeof e.relax_column_count_more!="boolean")if(e.relax_column_count_more===void 0||e.relax_column_count_more===null)e.relax_column_count_more=!1;else throw new Error(`Invalid Option: relax_column_count_more must be a boolean, got ${JSON.stringify(e.relax_column_count_more)}`);if(typeof e.relax_quotes!="boolean")if(e.relax_quotes===void 0||e.relax_quotes===null)e.relax_quotes=!1;else throw new Error(`Invalid Option: relax_quotes must be a boolean, got ${JSON.stringify(e.relax_quotes)}`);if(typeof e.skip_empty_lines!="boolean")if(e.skip_empty_lines===void 0||e.skip_empty_lines===null)e.skip_empty_lines=!1;else throw new Error(`Invalid Option: skip_empty_lines must be a boolean, got ${JSON.stringify(e.skip_empty_lines)}`);if(typeof e.skip_records_with_empty_values!="boolean")if(e.skip_records_with_empty_values===void 0||e.skip_records_with_empty_values===null)e.skip_records_with_empty_values=!1;else throw new Error(`Invalid Option: skip_records_with_empty_values must be a boolean, got ${JSON.stringify(e.skip_records_with_empty_values)}`);if(typeof e.skip_records_with_error!="boolean")if(e.skip_records_with_error===void 0||e.skip_records_with_error===null)e.skip_records_with_error=!1;else throw new Error(`Invalid Option: skip_records_with_error must be a boolean, got ${JSON.stringify(e.skip_records_with_error)}`);if(e.rtrim===void 0||e.rtrim===null||e.rtrim===!1)e.rtrim=!1;else if(e.rtrim!==!0)throw new Error(`Invalid Option: rtrim must be a boolean, got ${JSON.stringify(e.rtrim)}`);if(e.ltrim===void 0||e.ltrim===null||e.ltrim===!1)e.ltrim=!1;else if(e.ltrim!==!0)throw new Error(`Invalid Option: ltrim must be a boolean, got ${JSON.stringify(e.ltrim)}`);if(e.trim===void 0||e.trim===null||e.trim===!1)e.trim=!1;else if(e.trim!==!0)throw new Error(`Invalid Option: trim must be a boolean, got ${JSON.stringify(e.trim)}`);if(e.trim===!0&&r.ltrim!==!1?e.ltrim=!0:e.ltrim!==!0&&(e.ltrim=!1),e.trim===!0&&r.rtrim!==!1?e.rtrim=!0:e.rtrim!==!0&&(e.rtrim=!1),e.to===void 0||e.to===null)e.to=-1;else if(typeof e.to=="string"&&/\d+/.test(e.to)&&(e.to=parseInt(e.to)),Number.isInteger(e.to)){if(e.to<=0)throw new Error(`Invalid Option: to must be a positive integer greater than 0, got ${JSON.stringify(r.to)}`)}else throw new Error(`Invalid Option: to must be an integer, got ${JSON.stringify(r.to)}`);if(e.to_line===void 0||e.to_line===null)e.to_line=-1;else if(typeof e.to_line=="string"&&/\d+/.test(e.to_line)&&(e.to_line=parseInt(e.to_line)),Number.isInteger(e.to_line)){if(e.to_line<=0)throw new Error(`Invalid Option: to_line must be a positive integer greater than 0, got ${JSON.stringify(r.to_line)}`)}else throw new Error(`Invalid Option: to_line must be an integer, got ${JSON.stringify(r.to_line)}`);return e},ie=function(r){return r.every(e=>e==null||e.toString&&e.toString().trim()==="")},Re=13,De=10,J={utf8:d.Buffer.from([239,187,191]),utf16le:d.Buffer.from([255,254])},Le=function(r={}){const e={bytes:0,comment_lines:0,empty_lines:0,invalid_field_length:0,lines:1,records:0},_=ne(r);return{info:e,original_options:r,options:_,state:Ee(_),__needMoreData:function(t,n,l){if(l)return!1;const{encoding:a,escape:i,quote:m}=this.options,{quoting:h,needMoreDataSize:x,recordDelimiterMaxLength:I}=this.state,D=n-t-1,j=Math.max(x,I===0?d.Buffer.from(`\r
`,a).length:I,h?(i===null?0:i.length)+m.length:0,h?m.length+I:0);return D<j},parse:function(t,n,l,a){const{bom:i,comment_no_infix:m,encoding:h,from_line:x,ltrim:I,max_record_size:D,raw:j,relax_quotes:$,rtrim:N,skip_empty_lines:T,to:C,to_line:p}=this.options;let{comment:g,escape:R,quote:L,record_delimiter:z}=this.options;const{bomSkipped:F,previousBuf:u,rawBuffer:b,escapeIsQuote:c}=this.state;let f;if(u===void 0)if(t===void 0){a();return}else f=t;else u!==void 0&&t===void 0?f=u:f=d.Buffer.concat([u,t]);if(F===!1)if(i===!1)this.state.bomSkipped=!0;else if(f.length<3){if(n===!1){this.state.previousBuf=f;return}}else{for(const S in J)if(J[S].compare(f,0,J[S].length)===0){const O=J[S].length;this.state.bufBytesStart+=O,f=f.slice(O),this.options=ne({...this.original_options,encoding:S}),{comment:g,escape:R,quote:L}=this.options;break}this.state.bomSkipped=!0}const w=f.length;let o;for(o=0;o<w&&!this.__needMoreData(o,w,n);o++){if(this.state.wasRowDelimiter===!0&&(this.info.lines++,this.state.wasRowDelimiter=!1),p!==-1&&this.info.lines>p){this.state.stop=!0,a();return}this.state.quoting===!1&&z.length===0&&this.__autoDiscoverRecordDelimiter(f,o)&&(z=this.options.record_delimiter);const S=f[o];if(j===!0&&b.append(S),(S===Re||S===De)&&this.state.wasRowDelimiter===!1&&(this.state.wasRowDelimiter=!0),this.state.escaping===!0)this.state.escaping=!1;else{if(R!==null&&this.state.quoting===!0&&this.__isEscape(f,o,S)&&o+R.length<w)if(c){if(this.__isQuote(f,o+R.length)){this.state.escaping=!0,o+=R.length-1;continue}}else{this.state.escaping=!0,o+=R.length-1;continue}if(this.state.commenting===!1&&this.__isQuote(f,o))if(this.state.quoting===!0){const v=f[o+L.length],V=N&&this.__isCharTrimable(f,o+L.length),A=g!==null&&this.__compareBytes(g,f,o+L.length,v),k=this.__isDelimiter(f,o+L.length,v),P=z.length===0?this.__autoDiscoverRecordDelimiter(f,o+L.length):this.__isRecordDelimiter(v,f,o+L.length);if(R!==null&&this.__isEscape(f,o,S)&&this.__isQuote(f,o+R.length))o+=R.length-1;else if(!v||k||P||A||V){this.state.quoting=!1,this.state.wasQuoting=!0,o+=L.length-1;continue}else if($===!1){const Z=this.__error(new y("CSV_INVALID_CLOSING_QUOTE",["Invalid Closing Quote:",`got "${String.fromCharCode(v)}"`,`at line ${this.info.lines}`,"instead of delimiter, record delimiter, trimable character","(if activated) or comment"],this.options,this.__infoField()));if(Z!==void 0)return Z}else this.state.quoting=!1,this.state.wasQuoting=!0,this.state.field.prepend(L),o+=L.length-1}else if(this.state.field.length!==0){if($===!1){const v=this.__infoField(),V=Object.keys(J).map(k=>J[k].equals(this.state.field.toString())?k:!1).filter(Boolean)[0],A=this.__error(new y("INVALID_OPENING_QUOTE",["Invalid Opening Quote:",`a quote is found on field ${JSON.stringify(v.column)} at line ${v.lines}, value is ${JSON.stringify(this.state.field.toString(h))}`,V?`(${V} bom)`:void 0],this.options,v,{field:this.state.field}));if(A!==void 0)return A}}else{this.state.quoting=!0,o+=L.length-1;continue}if(this.state.quoting===!1){const v=this.__isRecordDelimiter(S,f,o);if(v!==0){if(this.state.commenting&&this.state.wasQuoting===!1&&this.state.record.length===0&&this.state.field.length===0)this.info.comment_lines++;else{if(this.state.enabled===!1&&this.info.lines+(this.state.wasRowDelimiter===!0?1:0)>=x){this.state.enabled=!0,this.__resetField(),this.__resetRecord(),o+=v-1;continue}if(T===!0&&this.state.wasQuoting===!1&&this.state.record.length===0&&this.state.field.length===0){this.info.empty_lines++,o+=v-1;continue}this.info.bytes=this.state.bufBytesStart+o;const k=this.__onField();if(k!==void 0)return k;this.info.bytes=this.state.bufBytesStart+o+v;const P=this.__onRecord(l);if(P!==void 0)return P;if(C!==-1&&this.info.records>=C){this.state.stop=!0,a();return}}this.state.commenting=!1,o+=v-1;continue}if(this.state.commenting)continue;if(g!==null&&(m===!1||this.state.record.length===0&&this.state.field.length===0)&&this.__compareBytes(g,f,o,S)!==0){this.state.commenting=!0;continue}const V=this.__isDelimiter(f,o,S);if(V!==0){this.info.bytes=this.state.bufBytesStart+o;const A=this.__onField();if(A!==void 0)return A;o+=V-1;continue}}}if(this.state.commenting===!1&&D!==0&&this.state.record_length+this.state.field.length>D)return this.__error(new y("CSV_MAX_RECORD_SIZE",["Max Record Size:","record exceed the maximum number of tolerated bytes",`of ${D}`,`at line ${this.info.lines}`],this.options,this.__infoField()));const O=I===!1||this.state.quoting===!0||this.state.field.length!==0||!this.__isCharTrimable(f,o),M=N===!1||this.state.wasQuoting===!1;if(O===!0&&M===!0)this.state.field.append(S);else{if(N===!0&&!this.__isCharTrimable(f,o))return this.__error(new y("CSV_NON_TRIMABLE_CHAR_AFTER_CLOSING_QUOTE",["Invalid Closing Quote:","found non trimable byte after quote",`at line ${this.info.lines}`],this.options,this.__infoField()));O===!1&&(o+=this.__isCharTrimable(f,o)-1);continue}}if(n===!0)if(this.state.quoting===!0){const S=this.__error(new y("CSV_QUOTE_NOT_CLOSED",["Quote Not Closed:",`the parsing is finished with an opening quote at line ${this.info.lines}`],this.options,this.__infoField()));if(S!==void 0)return S}else if(this.state.wasQuoting===!0||this.state.record.length!==0||this.state.field.length!==0){this.info.bytes=this.state.bufBytesStart+o;const S=this.__onField();if(S!==void 0)return S;const O=this.__onRecord(l);if(O!==void 0)return O}else this.state.wasRowDelimiter===!0?this.info.empty_lines++:this.state.commenting===!0&&this.info.comment_lines++;else this.state.bufBytesStart+=o,this.state.previousBuf=f.slice(o);this.state.wasRowDelimiter===!0&&(this.info.lines++,this.state.wasRowDelimiter=!1)},__onRecord:function(t){const{columns:n,group_columns_by_name:l,encoding:a,info:i,from:m,relax_column_count:h,relax_column_count_less:x,relax_column_count_more:I,raw:D,skip_records_with_empty_values:j}=this.options,{enabled:$,record:N}=this.state;if($===!1)return this.__resetRecord();const T=N.length;if(n===!0){if(j===!0&&ie(N)){this.__resetRecord();return}return this.__firstLineToColumns(N)}if(n===!1&&this.info.records===0&&(this.state.expectedRecordLength=T),T!==this.state.expectedRecordLength){const C=n===!1?new y("CSV_RECORD_INCONSISTENT_FIELDS_LENGTH",["Invalid Record Length:",`expect ${this.state.expectedRecordLength},`,`got ${T} on line ${this.info.lines}`],this.options,this.__infoField(),{record:N}):new y("CSV_RECORD_INCONSISTENT_COLUMNS",["Invalid Record Length:",`columns length is ${n.length},`,`got ${T} on line ${this.info.lines}`],this.options,this.__infoField(),{record:N});if(h===!0||x===!0&&T<this.state.expectedRecordLength||I===!0&&T>this.state.expectedRecordLength)this.info.invalid_field_length++,this.state.error=C;else{const p=this.__error(C);if(p)return p}}if(j===!0&&ie(N)){this.__resetRecord();return}if(this.state.recordHasError===!0){this.__resetRecord(),this.state.recordHasError=!1;return}if(this.info.records++,m===1||this.info.records>=m){const{objname:C}=this.options;if(n!==!1){const p={};for(let g=0,R=N.length;g<R;g++)n[g]===void 0||n[g].disabled||(l===!0&&p[n[g].name]!==void 0?Array.isArray(p[n[g].name])?p[n[g].name]=p[n[g].name].concat(N[g]):p[n[g].name]=[p[n[g].name],N[g]]:p[n[g].name]=N[g]);if(D===!0||i===!0){const g=Object.assign({record:p},D===!0?{raw:this.state.rawBuffer.toString(a)}:{},i===!0?{info:this.__infoRecord()}:{}),R=this.__push(C===void 0?g:[p[C],g],t);if(R)return R}else{const g=this.__push(C===void 0?p:[p[C],p],t);if(g)return g}}else if(D===!0||i===!0){const p=Object.assign({record:N},D===!0?{raw:this.state.rawBuffer.toString(a)}:{},i===!0?{info:this.__infoRecord()}:{}),g=this.__push(C===void 0?p:[N[C],p],t);if(g)return g}else{const p=this.__push(C===void 0?N:[N[C],N],t);if(p)return p}}this.__resetRecord()},__firstLineToColumns:function(t){const{firstLineToHeaders:n}=this.state;try{const l=n===void 0?t:n.call(null,t);if(!Array.isArray(l))return this.__error(new y("CSV_INVALID_COLUMN_MAPPING",["Invalid Column Mapping:","expect an array from column function,",`got ${JSON.stringify(l)}`],this.options,this.__infoField(),{headers:l}));const a=se(l);this.state.expectedRecordLength=a.length,this.options.columns=a,this.__resetRecord();return}catch(l){return l}},__resetRecord:function(){this.options.raw===!0&&this.state.rawBuffer.reset(),this.state.error=void 0,this.state.record=[],this.state.record_length=0},__onField:function(){const{cast:t,encoding:n,rtrim:l,max_record_size:a}=this.options,{enabled:i,wasQuoting:m}=this.state;if(i===!1)return this.__resetField();let h=this.state.field.toString(n);if(l===!0&&m===!1&&(h=h.trimRight()),t===!0){const[x,I]=this.__cast(h);if(x!==void 0)return x;h=I}this.state.record.push(h),a!==0&&typeof h=="string"&&(this.state.record_length+=h.length),this.__resetField()},__resetField:function(){this.state.field.reset(),this.state.wasQuoting=!1},__push:function(t,n){const{on_record:l}=this.options;if(l!==void 0){const a=this.__infoRecord();try{t=l.call(null,t,a)}catch(i){return i}if(t==null)return}n(t)},__cast:function(t){const{columns:n,relax_column_count:l}=this.options;if(Array.isArray(n)===!0&&l&&this.options.columns.length<=this.state.record.length)return[void 0,void 0];if(this.state.castField!==null)try{const i=this.__infoField();return[void 0,this.state.castField.call(null,t,i)]}catch(i){return[i]}if(this.__isFloat(t))return[void 0,parseFloat(t)];if(this.options.cast_date!==!1){const i=this.__infoField();return[void 0,this.options.cast_date.call(null,t,i)]}return[void 0,t]},__isCharTrimable:function(t,n){return((a,i)=>{const{timchars:m}=this.state;e:for(let h=0;h<m.length;h++){const x=m[h];for(let I=0;I<x.length;I++)if(x[I]!==a[i+I])continue e;return x.length}return 0})(t,n)},__isFloat:function(t){return t-parseFloat(t)+1>=0},__compareBytes:function(t,n,l,a){if(t[0]!==a)return 0;const i=t.length;for(let m=1;m<i;m++)if(t[m]!==n[l+m])return 0;return i},__isDelimiter:function(t,n,l){const{delimiter:a,ignore_last_delimiters:i}=this.options;if(i===!0&&this.state.record.length===this.options.columns.length-1)return 0;if(i!==!1&&typeof i=="number"&&this.state.record.length===i-1)return 0;e:for(let m=0;m<a.length;m++){const h=a[m];if(h[0]===l){for(let x=1;x<h.length;x++)if(h[x]!==t[n+x])continue e;return h.length}}return 0},__isRecordDelimiter:function(t,n,l){const{record_delimiter:a}=this.options,i=a.length;e:for(let m=0;m<i;m++){const h=a[m],x=h.length;if(h[0]===t){for(let I=1;I<x;I++)if(h[I]!==n[l+I])continue e;return h.length}}return 0},__isEscape:function(t,n,l){const{escape:a}=this.options;if(a===null)return!1;const i=a.length;if(a[0]===l){for(let m=0;m<i;m++)if(a[m]!==t[n+m])return!1;return!0}return!1},__isQuote:function(t,n){const{quote:l}=this.options;if(l===null)return!1;const a=l.length;for(let i=0;i<a;i++)if(l[i]!==t[n+i])return!1;return!0},__autoDiscoverRecordDelimiter:function(t,n){const{encoding:l}=this.options,a=[d.Buffer.from(`\r
`,l),d.Buffer.from(`
`,l),d.Buffer.from("\r",l)];e:for(let i=0;i<a.length;i++){const m=a[i].length;for(let h=0;h<m;h++)if(a[i][h]!==t[n+h])continue e;return this.options.record_delimiter.push(a[i]),this.state.recordDelimiterMaxLength=a[i].length,a[i].length}return 0},__error:function(t){const{encoding:n,raw:l,skip_records_with_error:a}=this.options,i=typeof t=="string"?new Error(t):t;if(a){this.state.recordHasError=!0,this.options.on_skip!==void 0&&this.options.on_skip(i,l?this.state.rawBuffer.toString(n):void 0);return}else return i},__infoDataSet:function(){return{...this.info,columns:this.options.columns}},__infoRecord:function(){const{columns:t,raw:n,encoding:l}=this.options;return{...this.__infoDataSet(),error:this.state.error,header:t===!0,index:this.state.record.length,raw:n?this.state.rawBuffer.toString(l):void 0}},__infoField:function(){const{columns:t}=this.options,n=Array.isArray(t);return{...this.__infoRecord(),column:n===!0?t.length>this.state.record.length?t[this.state.record.length].name:null:this.state.record.length,quoting:this.state.wasQuoting}}}},re=function(r,e={}){typeof r=="string"&&(r=d.Buffer.from(r));const _=e&&e.objname?{}:[],t=Le(e),n=m=>{t.options.objname===void 0?_.push(m):_[m[0]]=m[1]},l=()=>{},a=t.parse(r,!1,n,l);if(a!==void 0)throw a;const i=t.parse(void 0,!0,n,l);if(i!==void 0)throw i;return _},Be=["country","string","number","percentage"],Ct=({countries:r})=>{var L,z,F;const[e,_]=B.useState(""),[t,n]=B.useState(""),[l,a]=B.useState(""),[i,m]=B.useState(),[h,x]=B.useState([]),[I,D]=B.useState([]),[j,$]=B.useState([]),[N,T]=B.useState(!1);B.useEffect(()=>{const b=re(`Country;Fossil Fuel Spending (% share GDP);Education spending (% share GDP);;
    Afghanistan;9,184069;2,59;;
    Aalbania;1,8504;3,3;;`,{relax_column_count:!0,delimiter:";"});x(b),D(b.length?b[0].map((c,f)=>({index:f,label_en:c,label_es:c,label_fr:c,ignore:!c,type:c.toLowerCase()==="country"?"country":void 0})):[])},[]);const C=B.useCallback(async(u,b)=>{console.log("readFile");const c=new FileReader;return x([]),D([]),$([]),c.onloadend=()=>{const f=re(c.result,{relax_column_count:!0,delimiter:b});x(f),D(f.length?f[0].map((w,o)=>({index:o,label_en:w,label_es:w,label_fr:w,ignore:!w,type:w.toLowerCase()==="country"?"country":void 0})):[])},c.readAsText(u),()=>{c.onloadend=null}},[]);B.useEffect(()=>{i&&C(i,";")},[i,C]),B.useEffect(()=>{console.log("setValues");const u=I.filter(({ignore:w,type:o})=>!w&&o);if(!u.find(({type:w})=>w==="country")){$([]);return}const b=r.map(({id:w,name:o})=>({id:Number(w),name:o.toLowerCase()})),c=u.filter(({type:w})=>w==="country").at(0).index,f=h.slice(1).map(w=>{var S;const o=(S=u.filter(({type:O})=>O==="country").map(({index:O})=>b.find(({name:M})=>{var v;return M===((v=w.at(O))==null?void 0:v.trim().toLowerCase())})).find(O=>O==null?void 0:O.name))==null?void 0:S.id;return{country_label:w[c],country_id:o,values:u.filter(({type:O})=>O!=="country").map(({index:O,type:M})=>{const v=M==="number"||M==="percentage"?Number(w[O].replace(",",".")):w[O];return{column_index:O,value:v}})}});$(w=>f.map((o,S)=>{var O;return{...o,country_id:o.country_id?o.country_id:(O=w.at(S))==null?void 0:O.country_id}}))},[r,I,h]);const p=(u,b)=>{D(c=>{const f=[...c];return f[u]=b,f})},g=(u,b)=>{$(c=>{const f=[...c];return f[u]={...c[u],country_id:b},f})},R=()=>{const u=j.filter(({country_id:c})=>!!c).map(({country_id:c,values:f})=>({country_id:c,values:f})),b=I.filter(({ignore:c,type:f})=>!c&&f&&f!=="country").map(c=>({index:c.index,type:c.type,label_en:c.label_en,label_es:c.label_es,label_fr:c.label_fr}));oe.Inertia.post(ue("admin.geodata.import.store"),{data:u,columns:b,label:e,source_label:t,source_link:l})};return s.jsxs(s.Fragment,{children:[s.jsx(de,{title:"Import Geo Data"}),s.jsxs(me,{children:[s.jsxs(he,{sx:{m:2,p:2},children:["Select the data file, it should be formatted as CSV with"," ",s.jsx("code",{children:";"})," as column delimiter. The first row has to contain the column names.",s.jsx(ce,{onChange:u=>m((u.currentTarget.files||[])[0])})]}),s.jsxs(Q,{title:"Metadata",open:!0,children:[s.jsx(q,{label:"Data set label (internal)",value:e,onChange:u=>_(u.target.value)}),s.jsx(q,{label:"Data set source label",value:t,onChange:u=>n(u.target.value)}),s.jsx(q,{label:"Data set source link",value:l,onChange:u=>a(u.target.value)})]}),I.length>0&&s.jsx(Q,{title:"Columns",open:!0,children:s.jsxs(X,{size:"small",children:[s.jsx(ee,{children:s.jsxs(U,{children:[s.jsx(E,{children:"#"}),s.jsx(E,{children:"type"}),s.jsx(E,{children:"include"}),s.jsx(E,{children:"label EN"}),s.jsx(E,{children:"label FR"}),s.jsx(E,{children:"label ES"})]})}),s.jsx(K,{children:I.map((u,b)=>s.jsxs(U,{children:[s.jsx(E,{children:b}),s.jsx(E,{children:s.jsx(pe,{value:u.type||"",onChange:c=>p(b,{...u,type:c.target.value}),fullWidth:!0,size:"small",placeholder:"Type",margin:"none",children:Be.map(c=>s.jsx(H,{value:c,children:c},c))})}),s.jsx(E,{children:s.jsx(_e,{checked:!u.ignore,size:"small",onChange:(c,f)=>p(b,{...u,ignore:!f})})}),u.type==="country"?s.jsx(E,{colSpan:3}):s.jsxs(s.Fragment,{children:[s.jsx(E,{children:s.jsx(q,{value:u.label_en||"",onChange:c=>p(b,{...u,label_en:c.target.value}),size:"small",margin:"none"})}),s.jsx(E,{children:s.jsx(q,{value:u.label_fr||"",onChange:c=>p(b,{...u,label_fr:c.target.value}),size:"small",margin:"none"})}),s.jsx(E,{children:s.jsx(q,{value:u.label_es||"",onChange:c=>p(b,{...u,label_es:c.target.value}),size:"small",margin:"none"})})]})]},b))})]})}),j.length>0&&s.jsx(Q,{title:"Values",open:N,onOpen:T,children:s.jsxs(X,{size:"small",children:[s.jsx(ee,{children:s.jsxs(U,{children:[s.jsx(E,{children:"Country"}),I.filter(({ignore:u,type:b})=>!u&&b&&b!=="country").map(({index:u,label_en:b})=>s.jsx(E,{children:b},u))]})}),s.jsx(K,{children:N&&j.map(({country_label:u,country_id:b,values:c},f)=>s.jsxs(U,{children:[s.jsx(E,{children:s.jsx(Te,{country_id:b,onChange:w=>g(f,w),country_label:u,countries:r})}),c.map(({column_index:w,value:o})=>s.jsx(E,{children:o},w))]},u))})]})}),j.length>0&&s.jsxs(Q,{title:"Import",open:!0,children:[s.jsxs(G,{children:[j.length," entries of which"," ",s.jsxs("strong",{children:[j.filter(({country_id:u})=>!u).length," ","without a valid country"]})]}),s.jsxs(G,{children:[((L=j.at(0))==null?void 0:L.values.length)===1?"1 column is":`${(z=j.at(0))==null?void 0:z.values.length} columns are`," ","set to be imported"]}),s.jsx(be,{variant:"contained",disabled:!((F=j.at(0))!=null&&F.values.length),onClick:R,children:"Import Geo Data"})]})]})]})},Te=({country_id:r,onChange:e,country_label:_,countries:t})=>{const[n,l]=B.useState(!1),a=B.useMemo(()=>{var i;return((i=t.find(({id:m})=>m===r))==null?void 0:i.name)||_},[t,r,_]);return n?s.jsxs(q,{value:r||0,select:!0,SelectProps:{defaultOpen:!0},size:"small",margin:"none",onBlur:()=>l(!1),onChange:i=>{l(!1),e(Number(i.target.value))},children:[s.jsx(H,{value:0,children:s.jsxs(G,{display:"flex",alignItems:"center",children:[s.jsx(W,{color:"error",fontSize:"small"}),_]})}),t.map(({id:i,name:m})=>s.jsx(H,{value:i,children:m},i))]}):s.jsxs(G,{display:"flex",gap:.25,alignItems:"center",children:[s.jsx(ge,{onClick:()=>l(!0),sx:{p:.25},children:r?s.jsx(le,{fontSize:"small"}):s.jsx(W,{color:"error",fontSize:"small"})}),a]})};export{Ct as default};
